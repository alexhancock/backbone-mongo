!function(){var e=this,t=e._,n={},r=Array.prototype,o=Object.prototype,i=Function.prototype,a=r.push,u=r.slice,l=r.concat,c=o.toString,s=o.hasOwnProperty,f=r.forEach,d=r.map,h=r.reduce,p=r.reduceRight,v=r.filter,_=r.every,m=r.some,y=r.indexOf,g=r.lastIndexOf,b=Array.isArray,O=Object.keys,C=i.bind,E=function(e){return e instanceof E?e:this instanceof E?(this._wrapped=e,void 0):new E(e)};"undefined"!=typeof exports?("undefined"!=typeof module&&module.exports&&(exports=module.exports=E),exports._=E):e._=E,E.VERSION="1.4.4";var S=E.each=E.forEach=function(e,t,r){if(null!=e)if(f&&e.forEach===f)e.forEach(t,r);else if(e.length===+e.length){for(var o=0,i=e.length;i>o;o++)if(t.call(r,e[o],o,e)===n)return}else for(var a in e)if(E.has(e,a)&&t.call(r,e[a],a,e)===n)return};E.map=E.collect=function(e,t,n){var r=[];return null==e?r:d&&e.map===d?e.map(t,n):(S(e,function(e,o,i){r[r.length]=t.call(n,e,o,i)}),r)};var w="Reduce of empty array with no initial value";E.reduce=E.foldl=E.inject=function(e,t,n,r){var o=arguments.length>2;if(null==e&&(e=[]),h&&e.reduce===h)return r&&(t=E.bind(t,r)),o?e.reduce(t,n):e.reduce(t);if(S(e,function(e,i,a){o?n=t.call(r,n,e,i,a):(n=e,o=!0)}),!o)throw new TypeError(w);return n},E.reduceRight=E.foldr=function(e,t,n,r){var o=arguments.length>2;if(null==e&&(e=[]),p&&e.reduceRight===p)return r&&(t=E.bind(t,r)),o?e.reduceRight(t,n):e.reduceRight(t);var i=e.length;if(i!==+i){var a=E.keys(e);i=a.length}if(S(e,function(u,l,c){l=a?a[--i]:--i,o?n=t.call(r,n,e[l],l,c):(n=e[l],o=!0)}),!o)throw new TypeError(w);return n},E.find=E.detect=function(e,t,n){var r;return L(e,function(e,o,i){return t.call(n,e,o,i)?(r=e,!0):void 0}),r},E.filter=E.select=function(e,t,n){var r=[];return null==e?r:v&&e.filter===v?e.filter(t,n):(S(e,function(e,o,i){t.call(n,e,o,i)&&(r[r.length]=e)}),r)},E.reject=function(e,t,n){return E.filter(e,function(e,r,o){return!t.call(n,e,r,o)},n)},E.every=E.all=function(e,t,r){t||(t=E.identity);var o=!0;return null==e?o:_&&e.every===_?e.every(t,r):(S(e,function(e,i,a){return(o=o&&t.call(r,e,i,a))?void 0:n}),!!o)};var L=E.some=E.any=function(e,t,r){t||(t=E.identity);var o=!1;return null==e?o:m&&e.some===m?e.some(t,r):(S(e,function(e,i,a){return o||(o=t.call(r,e,i,a))?n:void 0}),!!o)};E.contains=E.include=function(e,t){return null==e?!1:y&&e.indexOf===y?-1!=e.indexOf(t):L(e,function(e){return e===t})},E.invoke=function(e,t){var n=u.call(arguments,2),r=E.isFunction(t);return E.map(e,function(e){return(r?t:e[t]).apply(e,n)})},E.pluck=function(e,t){return E.map(e,function(e){return e[t]})},E.where=function(e,t,n){return E.isEmpty(t)?n?null:[]:E[n?"find":"filter"](e,function(e){for(var n in t)if(t[n]!==e[n])return!1;return!0})},E.findWhere=function(e,t){return E.where(e,t,!0)},E.max=function(e,t,n){if(!t&&E.isArray(e)&&e[0]===+e[0]&&65535>e.length)return Math.max.apply(Math,e);if(!t&&E.isEmpty(e))return-1/0;var r={computed:-1/0,value:-1/0};return S(e,function(e,o,i){var a=t?t.call(n,e,o,i):e;a>=r.computed&&(r={value:e,computed:a})}),r.value},E.min=function(e,t,n){if(!t&&E.isArray(e)&&e[0]===+e[0]&&65535>e.length)return Math.min.apply(Math,e);if(!t&&E.isEmpty(e))return 1/0;var r={computed:1/0,value:1/0};return S(e,function(e,o,i){var a=t?t.call(n,e,o,i):e;r.computed>a&&(r={value:e,computed:a})}),r.value},E.shuffle=function(e){var t,n=0,r=[];return S(e,function(e){t=E.random(n++),r[n-1]=r[t],r[t]=e}),r};var A=function(e){return E.isFunction(e)?e:function(t){return t[e]}};E.sortBy=function(e,t,n){var r=A(t);return E.pluck(E.map(e,function(e,t,o){return{value:e,index:t,criteria:r.call(n,e,t,o)}}).sort(function(e,t){var n=e.criteria,r=t.criteria;if(n!==r){if(n>r||void 0===n)return 1;if(r>n||void 0===r)return-1}return e.index<t.index?-1:1}),"value")};var N=function(e,t,n,r){var o={},i=A(t||E.identity);return S(e,function(t,a){var u=i.call(n,t,a,e);r(o,u,t)}),o};E.groupBy=function(e,t,n){return N(e,t,n,function(e,t,n){(E.has(e,t)?e[t]:e[t]=[]).push(n)})},E.countBy=function(e,t,n){return N(e,t,n,function(e,t){E.has(e,t)||(e[t]=0),e[t]++})},E.sortedIndex=function(e,t,n,r){n=null==n?E.identity:A(n);for(var o=n.call(r,t),i=0,a=e.length;a>i;){var u=i+a>>>1;o>n.call(r,e[u])?i=u+1:a=u}return i},E.toArray=function(e){return e?E.isArray(e)?u.call(e):e.length===+e.length?E.map(e,E.identity):E.values(e):[]},E.size=function(e){return null==e?0:e.length===+e.length?e.length:E.keys(e).length},E.first=E.head=E.take=function(e,t,n){return null==e?void 0:null==t||n?e[0]:u.call(e,0,t)},E.initial=function(e,t,n){return u.call(e,0,e.length-(null==t||n?1:t))},E.last=function(e,t,n){return null==e?void 0:null==t||n?e[e.length-1]:u.call(e,Math.max(e.length-t,0))},E.rest=E.tail=E.drop=function(e,t,n){return u.call(e,null==t||n?1:t)},E.compact=function(e){return E.filter(e,E.identity)};var I=function(e,t,n){return S(e,function(e){E.isArray(e)?t?a.apply(n,e):I(e,t,n):n.push(e)}),n};E.flatten=function(e,t){return I(e,t,[])},E.without=function(e){return E.difference(e,u.call(arguments,1))},E.uniq=E.unique=function(e,t,n,r){E.isFunction(t)&&(r=n,n=t,t=!1);var o=n?E.map(e,n,r):e,i=[],a=[];return S(o,function(n,r){(t?r&&a[a.length-1]===n:E.contains(a,n))||(a.push(n),i.push(e[r]))}),i},E.union=function(){return E.uniq(l.apply(r,arguments))},E.intersection=function(e){var t=u.call(arguments,1);return E.filter(E.uniq(e),function(e){return E.every(t,function(t){return E.indexOf(t,e)>=0})})},E.difference=function(e){var t=l.apply(r,u.call(arguments,1));return E.filter(e,function(e){return!E.contains(t,e)})},E.zip=function(){for(var e=u.call(arguments),t=E.max(E.pluck(e,"length")),n=Array(t),r=0;t>r;r++)n[r]=E.pluck(e,""+r);return n},E.object=function(e,t){if(null==e)return{};for(var n={},r=0,o=e.length;o>r;r++)t?n[e[r]]=t[r]:n[e[r][0]]=e[r][1];return n},E.indexOf=function(e,t,n){if(null==e)return-1;var r=0,o=e.length;if(n){if("number"!=typeof n)return r=E.sortedIndex(e,t),e[r]===t?r:-1;r=0>n?Math.max(0,o+n):n}if(y&&e.indexOf===y)return e.indexOf(t,n);for(;o>r;r++)if(e[r]===t)return r;return-1},E.lastIndexOf=function(e,t,n){if(null==e)return-1;var r=null!=n;if(g&&e.lastIndexOf===g)return r?e.lastIndexOf(t,n):e.lastIndexOf(t);for(var o=r?n:e.length;o--;)if(e[o]===t)return o;return-1},E.range=function(e,t,n){1>=arguments.length&&(t=e||0,e=0),n=arguments[2]||1;for(var r=Math.max(Math.ceil((t-e)/n),0),o=0,i=Array(r);r>o;)i[o++]=e,e+=n;return i},E.bind=function(e,t){if(e.bind===C&&C)return C.apply(e,u.call(arguments,1));var n=u.call(arguments,2);return function(){return e.apply(t,n.concat(u.call(arguments)))}},E.partial=function(e){var t=u.call(arguments,1);return function(){return e.apply(this,t.concat(u.call(arguments)))}},E.bindAll=function(e){var t=u.call(arguments,1);return 0===t.length&&(t=E.functions(e)),S(t,function(t){e[t]=E.bind(e[t],e)}),e},E.memoize=function(e,t){var n={};return t||(t=E.identity),function(){var r=t.apply(this,arguments);return E.has(n,r)?n[r]:n[r]=e.apply(this,arguments)}},E.delay=function(e,t){var n=u.call(arguments,2);return setTimeout(function(){return e.apply(null,n)},t)},E.defer=function(e){return E.delay.apply(E,[e,1].concat(u.call(arguments,1)))},E.throttle=function(e,t){var n,r,o,i,a=0,u=function(){a=new Date,o=null,i=e.apply(n,r)};return function(){var l=new Date,c=t-(l-a);return n=this,r=arguments,0>=c?(clearTimeout(o),o=null,a=l,i=e.apply(n,r)):o||(o=setTimeout(u,c)),i}},E.debounce=function(e,t,n){var r,o;return function(){var i=this,a=arguments,u=function(){r=null,n||(o=e.apply(i,a))},l=n&&!r;return clearTimeout(r),r=setTimeout(u,t),l&&(o=e.apply(i,a)),o}},E.once=function(e){var t,n=!1;return function(){return n?t:(n=!0,t=e.apply(this,arguments),e=null,t)}},E.wrap=function(e,t){return function(){var n=[e];return a.apply(n,arguments),t.apply(this,n)}},E.compose=function(){var e=arguments;return function(){for(var t=arguments,n=e.length-1;n>=0;n--)t=[e[n].apply(this,t)];return t[0]}},E.after=function(e,t){return 0>=e?t():function(){return 1>--e?t.apply(this,arguments):void 0}},E.keys=O||function(e){if(e!==Object(e))throw new TypeError("Invalid object");var t=[];for(var n in e)E.has(e,n)&&(t[t.length]=n);return t},E.values=function(e){var t=[];for(var n in e)E.has(e,n)&&t.push(e[n]);return t},E.pairs=function(e){var t=[];for(var n in e)E.has(e,n)&&t.push([n,e[n]]);return t},E.invert=function(e){var t={};for(var n in e)E.has(e,n)&&(t[e[n]]=n);return t},E.functions=E.methods=function(e){var t=[];for(var n in e)E.isFunction(e[n])&&t.push(n);return t.sort()},E.extend=function(e){return S(u.call(arguments,1),function(t){if(t)for(var n in t)e[n]=t[n]}),e},E.pick=function(e){var t={},n=l.apply(r,u.call(arguments,1));return S(n,function(n){n in e&&(t[n]=e[n])}),t},E.omit=function(e){var t={},n=l.apply(r,u.call(arguments,1));for(var o in e)E.contains(n,o)||(t[o]=e[o]);return t},E.defaults=function(e){return S(u.call(arguments,1),function(t){if(t)for(var n in t)null==e[n]&&(e[n]=t[n])}),e},E.clone=function(e){return E.isObject(e)?E.isArray(e)?e.slice():E.extend({},e):e},E.tap=function(e,t){return t(e),e};var J=function(e,t,n,r){if(e===t)return 0!==e||1/e==1/t;if(null==e||null==t)return e===t;e instanceof E&&(e=e._wrapped),t instanceof E&&(t=t._wrapped);var o=c.call(e);if(o!=c.call(t))return!1;switch(o){case"[object String]":return e==t+"";case"[object Number]":return e!=+e?t!=+t:0==e?1/e==1/t:e==+t;case"[object Date]":case"[object Boolean]":return+e==+t;case"[object RegExp]":return e.source==t.source&&e.global==t.global&&e.multiline==t.multiline&&e.ignoreCase==t.ignoreCase}if("object"!=typeof e||"object"!=typeof t)return!1;for(var i=n.length;i--;)if(n[i]==e)return r[i]==t;n.push(e),r.push(t);var a=0,u=!0;if("[object Array]"==o){if(a=e.length,u=a==t.length)for(;a--&&(u=J(e[a],t[a],n,r)););}else{var l=e.constructor,s=t.constructor;if(l!==s&&!(E.isFunction(l)&&l instanceof l&&E.isFunction(s)&&s instanceof s))return!1;for(var f in e)if(E.has(e,f)&&(a++,!(u=E.has(t,f)&&J(e[f],t[f],n,r))))break;if(u){for(f in t)if(E.has(t,f)&&!a--)break;u=!a}}return n.pop(),r.pop(),u};E.isEqual=function(e,t){return J(e,t,[],[])},E.isEmpty=function(e){if(null==e)return!0;if(E.isArray(e)||E.isString(e))return 0===e.length;for(var t in e)if(E.has(e,t))return!1;return!0},E.isElement=function(e){return!(!e||1!==e.nodeType)},E.isArray=b||function(e){return"[object Array]"==c.call(e)},E.isObject=function(e){return e===Object(e)},S(["Arguments","Function","String","Number","Date","RegExp"],function(e){E["is"+e]=function(t){return c.call(t)=="[object "+e+"]"}}),E.isArguments(arguments)||(E.isArguments=function(e){return!(!e||!E.has(e,"callee"))}),"function"!=typeof/./&&(E.isFunction=function(e){return"function"==typeof e}),E.isFinite=function(e){return isFinite(e)&&!isNaN(parseFloat(e))},E.isNaN=function(e){return E.isNumber(e)&&e!=+e},E.isBoolean=function(e){return e===!0||e===!1||"[object Boolean]"==c.call(e)},E.isNull=function(e){return null===e},E.isUndefined=function(e){return void 0===e},E.has=function(e,t){return s.call(e,t)},E.noConflict=function(){return e._=t,this},E.identity=function(e){return e},E.times=function(e,t,n){for(var r=Array(e),o=0;e>o;o++)r[o]=t.call(n,o);return r},E.random=function(e,t){return null==t&&(t=e,e=0),e+Math.floor(Math.random()*(t-e+1))};var $={escape:{"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","/":"&#x2F;"}};$.unescape=E.invert($.escape);var j={escape:RegExp("["+E.keys($.escape).join("")+"]","g"),unescape:RegExp("("+E.keys($.unescape).join("|")+")","g")};E.each(["escape","unescape"],function(e){E[e]=function(t){return null==t?"":(""+t).replace(j[e],function(t){return $[e][t]})}}),E.result=function(e,t){if(null==e)return null;var n=e[t];return E.isFunction(n)?n.call(e):n},E.mixin=function(e){S(E.functions(e),function(t){var n=E[t]=e[t];E.prototype[t]=function(){var e=[this._wrapped];return a.apply(e,arguments),M.call(this,n.apply(E,e))}})};var k=0;E.uniqueId=function(e){var t=++k+"";return e?e+t:t},E.templateSettings={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,escape:/<%-([\s\S]+?)%>/g};var x=/(.)^/,T={"'":"'","\\":"\\","\r":"r","\n":"n","	":"t","\u2028":"u2028","\u2029":"u2029"},R=/\\|'|\r|\n|\t|\u2028|\u2029/g;E.template=function(e,t,n){var r;n=E.defaults({},n,E.templateSettings);var o=RegExp([(n.escape||x).source,(n.interpolate||x).source,(n.evaluate||x).source].join("|")+"|$","g"),i=0,a="__p+='";e.replace(o,function(t,n,r,o,u){return a+=e.slice(i,u).replace(R,function(e){return"\\"+T[e]}),n&&(a+="'+\n((__t=("+n+"))==null?'':_.escape(__t))+\n'"),r&&(a+="'+\n((__t=("+r+"))==null?'':__t)+\n'"),o&&(a+="';\n"+o+"\n__p+='"),i=u+t.length,t}),a+="';\n",n.variable||(a="with(obj||{}){\n"+a+"}\n"),a="var __t,__p='',__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,'');};\n"+a+"return __p;\n";try{r=Function(n.variable||"obj","_",a)}catch(u){throw u.source=a,u}if(t)return r(t,E);var l=function(e){return r.call(this,e,E)};return l.source="function("+(n.variable||"obj")+"){\n"+a+"}",l},E.chain=function(e){return E(e).chain()};var M=function(e){return this._chain?E(e).chain():e};E.mixin(E),S(["pop","push","reverse","shift","sort","splice","unshift"],function(e){var t=r[e];E.prototype[e]=function(){var n=this._wrapped;return t.apply(n,arguments),"shift"!=e&&"splice"!=e||0!==n.length||delete n[0],M.call(this,n)}}),S(["concat","join","slice"],function(e){var t=r[e];E.prototype[e]=function(){return M.call(this,t.apply(this._wrapped,arguments))}}),E.extend(E.prototype,{chain:function(){return this._chain=!0,this},value:function(){return this._wrapped}})}.call(this),define("underscore",function(e){return function(){var t;return t||e._}}(this)),LocalCollection=function(){this.docs={},this._observeQueue=new Meteor._SynchronousQueue,this.next_qid=1,this.queries={},this._savedOriginals=null,this.paused=!1},LocalCollection._applyChanges=function(e,t){_.each(t,function(t,n){void 0===t?delete e[n]:e[n]=t})},LocalCollection.MinimongoError=function(e){var t=this;t.name="MinimongoError",t.details=e},LocalCollection.MinimongoError.prototype=new Error,LocalCollection.prototype.find=function(e,t){return 0===arguments.length&&(e={}),new LocalCollection.Cursor(this,e,t)},LocalCollection.Cursor=function(e,t,n){var r=this;n||(n={}),this.collection=e,LocalCollection._selectorIsId(t)?(r.selector_id=LocalCollection._idStringify(t),r.selector_f=LocalCollection._compileSelector(t),r.sort_f=void 0):(r.selector_id=void 0,r.selector_f=LocalCollection._compileSelector(t),r.sort_f=n.sort?LocalCollection._compileSort(n.sort):null),r.skip=n.skip,r.limit=n.limit,r._transform=n.transform&&"undefined"!=typeof Deps?Deps._makeNonreactive(n.transform):n.transform,r.db_objects=null,r.cursor_pos=0,"undefined"!=typeof Deps&&(r.reactive=void 0===n.reactive?!0:n.reactive)},LocalCollection.Cursor.prototype.rewind=function(){var e=this;e.db_objects=null,e.cursor_pos=0},LocalCollection.prototype.findOne=function(e,t){return 0===arguments.length&&(e={}),t=t||{},t.limit=1,this.find(e,t).fetch()[0]},LocalCollection.Cursor.prototype.forEach=function(e){var t=this;for(null===t.db_objects&&(t.db_objects=t._getRawObjects(!0)),t.reactive&&t._depend({addedBefore:!0,removed:!0,changed:!0,movedBefore:!0});t.cursor_pos<t.db_objects.length;){var n=EJSON.clone(t.db_objects[t.cursor_pos++]);t._transform&&(n=t._transform(n)),e(n)}},LocalCollection.Cursor.prototype.getTransform=function(){var e=this;return e._transform},LocalCollection.Cursor.prototype.map=function(e){var t=this,n=[];return t.forEach(function(t){n.push(e(t))}),n},LocalCollection.Cursor.prototype.fetch=function(){var e=this,t=[];return e.forEach(function(e){t.push(e)}),t},LocalCollection.Cursor.prototype.count=function(){var e=this;return e.reactive&&e._depend({added:!0,removed:!0}),null===e.db_objects&&(e.db_objects=e._getRawObjects(!0)),e.db_objects.length},LocalCollection._isOrderedChanges=function(e){if(e.added&&e.addedBefore)throw new Error("Please specify only one of added() and addedBefore()");return"function"==typeof e.addedBefore||"function"==typeof e.movedBefore},LocalCollection.LiveResultsSet=function(){},_.extend(LocalCollection.Cursor.prototype,{observe:function(e){var t=this;return LocalCollection._observeFromObserveChanges(t,e)},observeChanges:function(e){var t=this,n=LocalCollection._isOrderedChanges(e);if(!n&&(t.skip||t.limit))throw new Error("must use ordered observe with skip or limit");var r,o={selector_f:t.selector_f,sort_f:n&&t.sort_f,results_snapshot:null,ordered:n,cursor:this,observeChanges:e.observeChanges};t.reactive&&(r=t.collection.next_qid++,t.collection.queries[r]=o),o.results=t._getRawObjects(n),t.collection.paused&&(o.results_snapshot=n?[]:{});var i=function(e){return e?function(){var n=this,r=arguments;t.collection.paused||t.collection._observeQueue.queueTask(function(){e.apply(n,r)})}:function(){}};o.added=i(e.added),o.changed=i(e.changed),o.removed=i(e.removed),n&&(o.moved=i(e.moved),o.addedBefore=i(e.addedBefore),o.movedBefore=i(e.movedBefore)),e._suppress_initial||t.collection.paused||_.each(o.results,function(e){var t=EJSON.clone(e);delete t._id,n&&o.addedBefore(e._id,t,null),o.added(e._id,t)});var a=new LocalCollection.LiveResultsSet;return _.extend(a,{collection:t.collection,stop:function(){t.reactive&&delete t.collection.queries[r]}}),t.reactive&&Deps.active&&Deps.onInvalidate(function(){a.stop()}),t.collection._observeQueue.drain(),a}}),LocalCollection.Cursor.prototype._getRawObjects=function(e){var t=this,n=e?[]:{};if(t.selector_id){if(t.skip)return n;if(_.has(t.collection.docs,t.selector_id)){var r=t.collection.docs[t.selector_id];e?n.push(r):n[t.selector_id]=r}return n}for(var o in t.collection.docs){var i=t.collection.docs[o];if(t.selector_f(i)&&(e?n.push(i):n[o]=i),t.limit&&!t.skip&&!t.sort_f&&n.length===t.limit)return n}if(!e)return n;t.sort_f&&n.sort(t.sort_f);var a=t.skip||0,u=t.limit?t.limit+a:n.length;return n.slice(a,u)},LocalCollection.Cursor.prototype._depend=function(e){var t=this;if(Deps.active){var n=new Deps.Dependency;n.depend();var r=_.bind(n.changed,n),o={_suppress_initial:!0};_.each(["added","changed","removed","addedBefore","movedBefore"],function(t){e[t]&&(o[t]=r)}),t.observeChanges(o)}},LocalCollection.prototype.insert=function(e){var t=this;if(_.isArray(e))return _.each(e,_.bind(t.insert,t));e=EJSON.clone(e),_.has(e,"_id")||(e._id=LocalCollection._useOID?new LocalCollection._ObjectID:Random.id());var n=LocalCollection._idStringify(e._id);if(_.has(t.docs,e._id))throw new LocalCollection.MinimongoError("Duplicate _id '"+e._id+"'");t._saveOriginal(n,void 0),t.docs[n]=e;var r=[];for(var o in t.queries){var i=t.queries[o];i.selector_f(e)&&(i.cursor.skip||i.cursor.limit?r.push(o):LocalCollection._insertInResults(i,e))}return _.each(r,function(e){t.queries[e]&&LocalCollection._recomputeResults(t.queries[e])}),t._observeQueue.drain(),e._id},LocalCollection.prototype.remove=function(e){var t=this,n=[],r=[],o=LocalCollection._compileSelector(e),i=LocalCollection._idsMatchedBySelector(e);if(i)_.each(i,function(e){var r=LocalCollection._idStringify(e);_.has(t.docs,r)&&o(t.docs[r])&&n.push(r)});else for(var a in t.docs){var u=t.docs[a];o(u)&&n.push(a)}for(var l=[],c=0;c<n.length;c++){var s=n[c],f=t.docs[s];_.each(t.queries,function(e,t){e.selector_f(f)&&(e.cursor.skip||e.cursor.limit?r.push(t):l.push({qid:t,doc:f}))}),t._saveOriginal(s,f),delete t.docs[s]}_.each(l,function(e){var n=t.queries[e.qid];n&&LocalCollection._removeFromResults(n,e.doc)}),_.each(r,function(e){var n=t.queries[e];n&&LocalCollection._recomputeResults(n)}),t._observeQueue.drain()},LocalCollection.prototype.update=function(e,t,n){var r=this;if(n||(n={}),n.upsert)throw new Error("upsert not yet implemented");var o=LocalCollection._compileSelector(e),i={};_.each(r.queries,function(e,t){!e.cursor.skip&&!e.cursor.limit||e.paused||(i[t]=EJSON.clone(e.results))});var a={};for(var u in r.docs){var l=r.docs[u];if(o(l)&&(r._saveOriginal(u,l),r._modifyAndNotify(l,t,a),!n.multi))break}_.each(a,function(e,t){var n=r.queries[t];n&&LocalCollection._recomputeResults(n,i[t])}),r._observeQueue.drain()},LocalCollection.prototype._modifyAndNotify=function(e,t,n){var r=this,o={};for(var i in r.queries){var a=r.queries[i];o[i]=a.ordered?a.selector_f(e):_.has(a.results,LocalCollection._idStringify(e._id))}var u=EJSON.clone(e);LocalCollection._modify(e,t);for(i in r.queries){a=r.queries[i];var l=o[i],c=a.selector_f(e);a.cursor.skip||a.cursor.limit?(l||c)&&(n[i]=!0):l&&!c?LocalCollection._removeFromResults(a,e):!l&&c?LocalCollection._insertInResults(a,e):l&&c&&LocalCollection._updateInResults(a,e,u)}},LocalCollection._insertInResults=function(e,t){var n=EJSON.clone(t);if(delete n._id,e.ordered){if(e.sort_f){var r=LocalCollection._insertInSortedList(e.sort_f,e.results,t),o=e.results[r+1];o=o?o._id:null,e.addedBefore(t._id,n,o)}else e.addedBefore(t._id,n,null),e.results.push(t);e.added(t._id,n)}else e.added(t._id,n),e.results[LocalCollection._idStringify(t._id)]=t},LocalCollection._removeFromResults=function(e,t){if(e.ordered){var n=LocalCollection._findInOrderedResults(e,t);e.removed(t._id),e.results.splice(n,1)}else{var r=LocalCollection._idStringify(t._id);e.removed(t._id),delete e.results[r]}},LocalCollection._updateInResults=function(e,t,n){if(!EJSON.equals(t._id,n._id))throw new Error("Can't change a doc's _id while updating");var r=LocalCollection._makeChangedFields(t,n);if(!e.ordered)return _.isEmpty(r)||(e.changed(t._id,r),e.results[LocalCollection._idStringify(t._id)]=t),void 0;var o=LocalCollection._findInOrderedResults(e,t);if(_.isEmpty(r)||e.changed(t._id,r),e.sort_f){e.results.splice(o,1);var i=LocalCollection._insertInSortedList(e.sort_f,e.results,t);if(o!==i){var a=e.results[i+1];a=a?a._id:null,e.movedBefore&&e.movedBefore(t._id,a)}}},LocalCollection._recomputeResults=function(e,t){t||(t=e.results),e.results=e.cursor._getRawObjects(e.ordered),e.paused||LocalCollection._diffQueryChanges(e.ordered,t,e.results,e)},LocalCollection._findInOrderedResults=function(e,t){if(!e.ordered)throw new Error("Can't call _findInOrderedResults on unordered query");for(var n=0;n<e.results.length;n++)if(e.results[n]===t)return n;throw Error("object missing from query")},LocalCollection._binarySearch=function(e,t,n){for(var r=0,o=t.length;o>0;){var i=Math.floor(o/2);e(n,t[r+i])>=0?(r+=i+1,o-=i+1):o=i}return r},LocalCollection._insertInSortedList=function(e,t,n){if(0===t.length)return t.push(n),0;var r=LocalCollection._binarySearch(e,t,n);return t.splice(r,0,n),r},LocalCollection.prototype.saveOriginals=function(){var e=this;if(e._savedOriginals)throw new Error("Called saveOriginals twice without retrieveOriginals");e._savedOriginals={}},LocalCollection.prototype.retrieveOriginals=function(){var e=this;if(!e._savedOriginals)throw new Error("Called retrieveOriginals without saveOriginals");var t=e._savedOriginals;return e._savedOriginals=null,t},LocalCollection.prototype._saveOriginal=function(e,t){var n=this;n._savedOriginals&&(_.has(n._savedOriginals,e)||(n._savedOriginals[e]=EJSON.clone(t)))},LocalCollection.prototype.pauseObservers=function(){if(!this.paused){this.paused=!0;for(var e in this.queries){var t=this.queries[e];t.results_snapshot=EJSON.clone(t.results)}}},LocalCollection.prototype.resumeObservers=function(){var e=this;if(this.paused){this.paused=!1;for(var t in this.queries){var n=e.queries[t];LocalCollection._diffQueryChanges(n.ordered,n.results_snapshot,n.results,n),n.results_snapshot=null}e._observeQueue.drain()}},LocalCollection._idStringify=function(e){if(e instanceof LocalCollection._ObjectID)return e.valueOf();if("string"==typeof e)return""===e?e:"-"===e.substr(0,1)||"~"===e.substr(0,1)||LocalCollection._looksLikeObjectID(e)||"{"===e.substr(0,1)?"-"+e:e;if(void 0===e)return"-";if("object"==typeof e)throw new Error("Meteor does not currently support objects other than ObjectID as ids");return"~"+JSON.stringify(e)},LocalCollection._idParse=function(e){return""===e?e:"-"===e?void 0:"-"===e.substr(0,1)?e.substr(1):"~"===e.substr(0,1)?JSON.parse(e.substr(1)):LocalCollection._looksLikeObjectID(e)?new LocalCollection._ObjectID(e):e},"undefined"!=typeof Meteor&&(Meteor.idParse=LocalCollection._idParse,Meteor.idStringify=LocalCollection._idStringify),LocalCollection._makeChangedFields=function(e,t){var n={};return LocalCollection._diffObjects(t,e,{leftOnly:function(e){n[e]=void 0},rightOnly:function(e,t){n[e]=t},both:function(e,t,r){EJSON.equals(t,r)||(n[e]=r)}}),n},LocalCollection._observeFromObserveChanges=function(e,t){var n=e.getTransform();if(n||(n=function(e){return e}),t.addedAt&&t.added)throw new Error("Please specify only one of added() and addedAt()");if(t.changedAt&&t.changed)throw new Error("Please specify only one of changed() and changedAt()");if(t.removed&&t.removedAt)throw new Error("Please specify only one of removed() and removedAt()");return t.addedAt||t.movedTo||t.changedAt||t.removedAt?LocalCollection._observeOrderedFromObserveChanges(e,t,n):LocalCollection._observeUnorderedFromObserveChanges(e,t,n)},LocalCollection._observeUnorderedFromObserveChanges=function(e,t,n){var r={},o=!!t._suppress_initial,i=e.observeChanges({added:function(e,i){var a=LocalCollection._idStringify(e),u=EJSON.clone(i);u._id=e,r[a]=u,o||t.added&&t.added(n(u))},changed:function(e,i){var a=LocalCollection._idStringify(e),u=r[a],l=EJSON.clone(u);LocalCollection._applyChanges(u,i),o||t.changed&&t.changed(n(u),n(l))},removed:function(e){var i=LocalCollection._idStringify(e),a=r[i];delete r[i],o||t.removed&&t.removed(n(a))}});return o=!1,i},LocalCollection._observeOrderedFromObserveChanges=function(e,t,n){var r=new OrderedDict(LocalCollection._idStringify),o=!!t._suppress_initial,i=e.observeChanges({addedBefore:function(e,i,a){var u=EJSON.clone(i);if(u._id=e,r.putBefore(e,u,a?a:null),!o)if(t.addedAt){var l=r.indexOf(e);t.addedAt(n(EJSON.clone(u)),l,a)}else t.added&&t.added(n(EJSON.clone(u)))},changed:function(e,o){var i=r.get(e);if(!i)throw new Error("Unknown id for changed: "+e);var a=EJSON.clone(i);if(LocalCollection._applyChanges(i,o),t.changedAt){var u=r.indexOf(e);t.changedAt(n(EJSON.clone(i)),n(a),u)}else t.changed&&t.changed(n(EJSON.clone(i)),n(a))},movedBefore:function(e,o){var i,a=r.get(e);if(t.movedTo&&(i=r.indexOf(e)),r.moveBefore(e,o?o:null),t.movedTo){var u=r.indexOf(e);t.movedTo(n(EJSON.clone(a)),i,u)}else t.moved&&t.moved(n(EJSON.clone(a)))},removed:function(e){var o,i=r.get(e);t.removedAt&&(o=r.indexOf(e)),r.remove(e),t.removedAt&&t.removedAt(n(i),o),t.removed&&t.removed(n(i))}});return o=!1,i},define("minimongo",["underscore"],function(e){return function(){var t;return t||e.LocalCollection}}(this)),LocalCollection._modify=function(e,t){var n=!1;for(var r in t){n="$"===r.substr(0,1);break}var o;if(n){var o=EJSON.clone(e);for(var i in t){var a=LocalCollection._modifiers[i];if(!a)throw Error("Invalid modifier specified "+i);for(var u in t[i]){if(u.length&&"."===u[u.length-1])throw Error("Invalid mod field name, may not end in a period");var l=t[i][u],c=u.split("."),s=!!LocalCollection._noCreateModifiers[i],f="$rename"===i,d=LocalCollection._findModTarget(o,c,s,f),h=c.pop();a(d,h,l,u,o)}}}else{if(t._id&&!EJSON.equals(e._id,t._id))throw Error("Cannot change the _id of a document");for(var r in t){if("$"===r.substr(0,1))throw Error("When replacing document, field name may not start with '$'");if(/\./.test(r))throw Error("When replacing document, field name may not contain '.'")}o=t}_.each(_.keys(e),function(t){"_id"!==t&&delete e[t]});for(var r in o)e[r]=o[r]},LocalCollection._findModTarget=function(e,t,n,r){for(var o=0;o<t.length;o++){var i=o===t.length-1,a=t[o],u=/^[0-9]+$/.test(a);if(!(!n||"object"==typeof e&&a in e))return void 0;if(e instanceof Array){if(r)return null;if(!u)throw Error("can't append to array using string field name ["+a+"]");for(a=parseInt(a),i&&(t[o]=a);e.length<a;)e.push(null);if(!i)if(e.length===a)e.push({});else if("object"!=typeof e[a])throw Error("can't modify field '"+t[o+1]+"' of list value "+JSON.stringify(e[a]))}else i||a in e||(e[a]={});if(i)return e;e=e[a]}},LocalCollection._noCreateModifiers={$unset:!0,$pop:!0,$rename:!0,$pull:!0,$pullAll:!0},LocalCollection._modifiers={$inc:function(e,t,n){if("number"!=typeof n)throw Error("Modifier $inc allowed for numbers only");if(t in e){if("number"!=typeof e[t])throw Error("Cannot apply $inc modifier to non-number");e[t]+=n}else e[t]=n},$set:function(e,t,n){if("_id"===t&&!EJSON.equals(n,e._id))throw Error("Cannot change the _id of a document");e[t]=EJSON.clone(n)},$unset:function(e,t){void 0!==e&&(e instanceof Array?t in e&&(e[t]=null):delete e[t])},$push:function(e,t,n){var r=e[t];if(void 0===r)e[t]=[n];else{if(!(r instanceof Array))throw Error("Cannot apply $push modifier to non-array");r.push(EJSON.clone(n))}},$pushAll:function(e,t,n){if(!("object"==typeof n&&n instanceof Array))throw Error("Modifier $pushAll/pullAll allowed for arrays only");var r=e[t];if(void 0===r)e[t]=n;else{if(!(r instanceof Array))throw Error("Cannot apply $pushAll modifier to non-array");for(var o=0;o<n.length;o++)r.push(n[o])}},$addToSet:function(e,t,n){var r=e[t];if(void 0===r)e[t]=[n];else{if(!(r instanceof Array))throw Error("Cannot apply $addToSet modifier to non-array");var o=!1;if("object"==typeof n)for(var i in n){"$each"===i&&(o=!0);break}var a=o?n.$each:[n];_.each(a,function(e){for(var t=0;t<r.length;t++)if(LocalCollection._f._equal(e,r[t]))return;r.push(e)})}},$pop:function(e,t,n){if(void 0!==e){var r=e[t];if(void 0!==r){if(!(r instanceof Array))throw Error("Cannot apply $pop modifier to non-array");"number"==typeof n&&0>n?r.splice(0,1):r.pop()}}},$pull:function(e,t,n){if(void 0!==e){var r=e[t];if(void 0!==r){if(!(r instanceof Array))throw Error("Cannot apply $pull/pullAll modifier to non-array");var o=[];if("object"!=typeof n||n instanceof Array)for(var i=0;i<r.length;i++)LocalCollection._f._equal(r[i],n)||o.push(r[i]);else for(var a=LocalCollection._compileSelector(n),i=0;i<r.length;i++)a(r[i])||o.push(r[i]);e[t]=o}}},$pullAll:function(e,t,n){if(!("object"==typeof n&&n instanceof Array))throw Error("Modifier $pushAll/pullAll allowed for arrays only");if(void 0!==e){var r=e[t];if(void 0!==r){if(!(r instanceof Array))throw Error("Cannot apply $pull/pullAll modifier to non-array");for(var o=[],i=0;i<r.length;i++){for(var a=!1,u=0;u<n.length;u++)if(LocalCollection._f._equal(r[i],n[u])){a=!0;break}a||o.push(r[i])}e[t]=o}}},$rename:function(e,t,n,r,o){if(r===n)throw Error("$rename source must differ from target");if(null===e)throw Error("$rename source field invalid");if("string"!=typeof n)throw Error("$rename target must be a string");if(void 0!==e){var i=e[t];delete e[t];var a=n.split("."),u=LocalCollection._findModTarget(o,a,!1,!0);if(null===u)throw Error("$rename target field invalid");var l=a.pop();u[l]=i}},$bit:function(){throw Error("$bit is not supported")}},define("lib/minimongo-modify",function(){}),EJSON={};var customTypes={};EJSON.addType=function(e,t){if(_.has(customTypes,e))throw new Error("Type "+e+" already present");customTypes[e]=t};var builtinConverters=[{matchJSONValue:function(e){return _.has(e,"$date")&&1===_.size(e)},matchObject:function(e){return e instanceof Date},toJSONValue:function(e){return{$date:e.getTime()}},fromJSONValue:function(e){return new Date(e.$date)}},{matchJSONValue:function(e){return _.has(e,"$binary")&&1===_.size(e)},matchObject:function(e){return"undefined"!=typeof Uint8Array&&e instanceof Uint8Array||e&&_.has(e,"$Uint8ArrayPolyfill")},toJSONValue:function(e){return{$binary:EJSON._base64Encode(e)}},fromJSONValue:function(e){return EJSON._base64Decode(e.$binary)}},{matchJSONValue:function(e){return _.has(e,"$escape")&&1===_.size(e)},matchObject:function(e){return _.isEmpty(e)||_.size(e)>2?!1:_.any(builtinConverters,function(t){return t.matchJSONValue(e)})},toJSONValue:function(e){var t={};return _.each(e,function(e,n){t[n]=EJSON.toJSONValue(e)}),{$escape:t}},fromJSONValue:function(e){var t={};return _.each(e.$escape,function(e,n){t[n]=EJSON.fromJSONValue(e)}),t}},{matchJSONValue:function(e){return _.has(e,"$type")&&_.has(e,"$value")&&2===_.size(e)},matchObject:function(e){return EJSON._isCustomType(e)},toJSONValue:function(e){return{$type:e.typeName(),$value:e.toJSONValue()}
},fromJSONValue:function(e){var t=e.$type,n=customTypes[t];return n(e.$value)}}];EJSON._isCustomType=function(e){return e&&"function"==typeof e.toJSONValue&&"function"==typeof e.typeName&&_.has(customTypes,e.typeName())};var adjustTypesToJSONValue=EJSON._adjustTypesToJSONValue=function(e){if(null===e)return null;var t=toJSONValueHelper(e);return void 0!==t?t:(_.each(e,function(t,n){if("object"==typeof t||void 0===t){var r=toJSONValueHelper(t);return r?(e[n]=r,void 0):(adjustTypesToJSONValue(t),void 0)}}),e)},toJSONValueHelper=function(e){for(var t=0;t<builtinConverters.length;t++){var n=builtinConverters[t];if(n.matchObject(e))return n.toJSONValue(e)}return void 0};EJSON.toJSONValue=function(e){var t=toJSONValueHelper(e);return void 0!==t?t:("object"==typeof e&&(e=EJSON.clone(e),adjustTypesToJSONValue(e)),e)};var adjustTypesFromJSONValue=EJSON._adjustTypesFromJSONValue=function(e){if(null===e)return null;var t=fromJSONValueHelper(e);return t!==e?t:(_.each(e,function(t,n){if("object"==typeof t){var r=fromJSONValueHelper(t);if(t!==r)return e[n]=r,void 0;adjustTypesFromJSONValue(t)}}),e)},fromJSONValueHelper=function(e){if("object"==typeof e&&null!==e&&_.size(e)<=2&&_.all(e,function(e,t){return"string"==typeof t&&"$"===t.substr(0,1)}))for(var t=0;t<builtinConverters.length;t++){var n=builtinConverters[t];if(n.matchJSONValue(e))return n.fromJSONValue(e)}return e};EJSON.fromJSONValue=function(e){var t=fromJSONValueHelper(e);return t===e&&"object"==typeof e?(e=EJSON.clone(e),adjustTypesFromJSONValue(e),e):t},EJSON.stringify=function(e){return JSON.stringify(EJSON.toJSONValue(e))},EJSON.parse=function(e){return EJSON.fromJSONValue(JSON.parse(e))},EJSON.isBinary=function(e){return!!("undefined"!=typeof Uint8Array&&e instanceof Uint8Array||e&&e.$Uint8ArrayPolyfill)},EJSON.equals=function(e,t,n){var r,o=!(!n||!n.keyOrderSensitive);if(e===t)return!0;if(!e||!t)return!1;if("object"!=typeof e||"object"!=typeof t)return!1;if(e instanceof Date&&t instanceof Date)return e.valueOf()===t.valueOf();if(EJSON.isBinary(e)&&EJSON.isBinary(t)){if(e.length!==t.length)return!1;for(r=0;r<e.length;r++)if(e[r]!==t[r])return!1;return!0}if("function"==typeof e.equals)return e.equals(t,n);if(e instanceof Array){if(!(t instanceof Array))return!1;if(e.length!==t.length)return!1;for(r=0;r<e.length;r++)if(!EJSON.equals(e[r],t[r],n))return!1;return!0}var i;if(o){var a=[];return _.each(t,function(e,t){a.push(t)}),r=0,i=_.all(e,function(e,o){return r>=a.length?!1:o!==a[r]?!1:EJSON.equals(e,t[a[r]],n)?(r++,!0):!1}),i&&r===a.length}return r=0,i=_.all(e,function(e,o){return _.has(t,o)?EJSON.equals(e,t[o],n)?(r++,!0):!1:!1}),i&&_.size(t)===r},EJSON.clone=function(e){var t;if("object"!=typeof e)return e;if(null===e)return null;if(e instanceof Date)return new Date(e.getTime());if(EJSON.isBinary(e)){t=EJSON.newBinary(e.length);for(var n=0;n<e.length;n++)t[n]=e[n];return t}if(_.isArray(e)||_.isArguments(e)){for(t=[],n=0;n<e.length;n++)t[n]=EJSON.clone(e[n]);return t}return"function"==typeof e.clone,t={},_.each(e,function(e,n){t[n]=EJSON.clone(e)}),t},define("lib/ejson",function(){}),LocalCollection._looksLikeObjectID=function(e){return 24===e.length&&e.match(/^[0-9a-f]*$/)},LocalCollection._ObjectID=function(e){var t=this;if(e){if(e=e.toLowerCase(),!LocalCollection._looksLikeObjectID(e))throw new Error("Invalid hexadecimal string for creating an ObjectID");t._str=e}else t._str=Random.hexString(24)},LocalCollection._ObjectID.prototype.toString=function(){var e=this;return'ObjectID("'+e._str+'")'},LocalCollection._ObjectID.prototype.equals=function(e){var t=this;return e instanceof LocalCollection._ObjectID&&t.valueOf()===e.valueOf()},LocalCollection._ObjectID.prototype.clone=function(){var e=this;return new LocalCollection._ObjectID(e._str)},LocalCollection._ObjectID.prototype.typeName=function(){return"oid"},LocalCollection._ObjectID.prototype.getTimestamp=function(){var e=this;return parseInt(e._str.substr(0,8),16)},LocalCollection._ObjectID.prototype.valueOf=LocalCollection._ObjectID.prototype.toJSONValue=LocalCollection._ObjectID.prototype.toHexString=function(){return this._str},LocalCollection._selectorIsId=function(e){return"string"==typeof e||"number"==typeof e||e instanceof LocalCollection._ObjectID},LocalCollection._selectorIsIdPerhapsAsObject=function(e){return LocalCollection._selectorIsId(e)||e&&"object"==typeof e&&e._id&&LocalCollection._selectorIsId(e._id)&&1===_.size(e)},LocalCollection._idsMatchedBySelector=function(e){if(LocalCollection._selectorIsId(e))return[e];if(!e)return null;if(_.has(e,"_id"))return LocalCollection._selectorIsId(e._id)?[e._id]:e._id&&e._id.$in&&_.isArray(e._id.$in)&&!_.isEmpty(e._id.$in)&&_.all(e._id.$in,LocalCollection._selectorIsId)?e._id.$in:null;if(e.$and&&_.isArray(e.$and))for(var t=0;t<e.$and.length;++t){var n=LocalCollection._idsMatchedBySelector(e.$and[t]);if(n)return n}return null},EJSON.addType("oid",function(e){return new LocalCollection._ObjectID(e)}),define("lib/oid",function(){});var Alea=function(){function e(){var e=4022871197,t=function(t){t=t.toString();for(var n=0;n<t.length;n++){e+=t.charCodeAt(n);var r=.02519603282416938*e;e=r>>>0,r-=e,r*=e,e=r>>>0,r-=e,e+=4294967296*r}return 2.3283064365386963e-10*(e>>>0)};return t.version="Mash 0.9",t}return function(t){var n=0,r=0,o=0,i=1;0==t.length&&(t=[+new Date]);var a=e();n=a(" "),r=a(" "),o=a(" ");for(var u=0;u<t.length;u++)n-=a(t[u]),0>n&&(n+=1),r-=a(t[u]),0>r&&(r+=1),o-=a(t[u]),0>o&&(o+=1);a=null;var l=function(){var e=2091639*n+2.3283064365386963e-10*i;return n=r,r=o,o=e-(i=0|e)};return l.uint32=function(){return 4294967296*l()},l.fract53=function(){return l()+1.1102230246251565e-16*(0|2097152*l())},l.version="Alea 0.9",l.args=t,l}(Array.prototype.slice.call(arguments))},UNMISTAKABLE_CHARS="23456789ABCDEFGHJKLMNPQRSTWXYZabcdefghijkmnopqrstuvwxyz",create=function(){var e=Alea.apply(null,arguments),t={},n=function(e){return _.bind(e,t)};return _.extend(t,{_Alea:Alea,create:create,fraction:e,choice:n(function(e){var t=Math.floor(this.fraction()*e.length);return"string"==typeof e?e.substr(t,1):e[t]}),id:n(function(){for(var e=[],t=0;17>t;t++)e[t]=this.choice(UNMISTAKABLE_CHARS);return e.join("")}),hexString:n(function(e){for(var t=[],n=0;e>n;++n)t.push(this.choice("0123456789abcdef"));return t.join("")})})},height="undefined"!=typeof window&&window.innerHeight||"undefined"!=typeof document&&document.documentElement&&document.documentElement.clientHeight||"undefined"!=typeof document&&document.body&&document.body.clientHeight||1,width="undefined"!=typeof window&&window.innerWidth||"undefined"!=typeof document&&document.documentElement&&document.documentElement.clientWidth||"undefined"!=typeof document&&document.body&&document.body.clientWidth||1,agent="undefined"!=typeof navigator&&navigator.userAgent||"",pid="undefined"!=typeof process&&process.pid||1;Random=create([new Date,height,width,agent,pid,Math.random()]),define("lib/random",function(){});var isArray=function(e){return _.isArray(e)&&!EJSON.isBinary(e)},_anyIfArray=function(e,t){return isArray(e)?_.any(e,t):t(e)},_anyIfArrayPlus=function(e,t){return t(e)?!0:isArray(e)&&_.any(e,t)},hasOperators=function(e){var t=void 0;for(var n in e){var r="$"===n.substr(0,1);if(void 0===t)t=r;else if(t!==r)throw new Error("Inconsistent selector: "+e)}return!!t},compileValueSelector=function(e){if(null==e)return function(e){return _anyIfArray(e,function(e){return null==e})};if(!_.isObject(e))return function(t){return _anyIfArray(t,function(t){return t===e})};if(e instanceof RegExp)return function(t){return void 0===t?!1:_anyIfArray(t,function(t){return e.test(t)})};if(isArray(e))return function(t){return isArray(t)?_anyIfArrayPlus(t,function(t){return LocalCollection._f._equal(e,t)}):!1};if(hasOperators(e)){var t=[];return _.each(e,function(n,r){if(!_.has(VALUE_OPERATORS,r))throw new Error("Unrecognized operator: "+r);t.push(VALUE_OPERATORS[r](n,e.$options))}),function(e){return _.all(t,function(t){return t(e)})}}return function(t){return _anyIfArray(t,function(t){return LocalCollection._f._equal(e,t)})}},LOGICAL_OPERATORS={$and:function(e){if(!isArray(e)||_.isEmpty(e))throw Error("$and/$or/$nor must be nonempty array");var t=_.map(e,compileDocumentSelector);return function(e){return _.all(t,function(t){return t(e)})}},$or:function(e){if(!isArray(e)||_.isEmpty(e))throw Error("$and/$or/$nor must be nonempty array");var t=_.map(e,compileDocumentSelector);return function(e){return _.any(t,function(t){return t(e)})}},$nor:function(e){if(!isArray(e)||_.isEmpty(e))throw Error("$and/$or/$nor must be nonempty array");var t=_.map(e,compileDocumentSelector);return function(e){return _.all(t,function(t){return!t(e)})}},$where:function(e){return e instanceof Function||(e=Function("return "+e)),function(t){return e.call(t)}}},VALUE_OPERATORS={$in:function(e){if(!isArray(e))throw new Error("Argument to $in must be array");return function(t){return _anyIfArrayPlus(t,function(t){return _.any(e,function(e){return LocalCollection._f._equal(e,t)})})}},$all:function(e){if(!isArray(e))throw new Error("Argument to $all must be array");return function(t){return isArray(t)?_.all(e,function(e){return _.any(t,function(t){return LocalCollection._f._equal(e,t)})}):!1}},$lt:function(e){return function(t){return _anyIfArray(t,function(t){return LocalCollection._f._cmp(t,e)<0})}},$lte:function(e){return function(t){return _anyIfArray(t,function(t){return LocalCollection._f._cmp(t,e)<=0})}},$gt:function(e){return function(t){return _anyIfArray(t,function(t){return LocalCollection._f._cmp(t,e)>0})}},$gte:function(e){return function(t){return _anyIfArray(t,function(t){return LocalCollection._f._cmp(t,e)>=0})}},$ne:function(e){return function(t){return!_anyIfArrayPlus(t,function(t){return LocalCollection._f._equal(t,e)})}},$nin:function(e){if(!isArray(e))throw new Error("Argument to $nin must be array");var t=VALUE_OPERATORS.$in(e);return function(e){return void 0===e?!0:!t(e)}},$exists:function(e){return function(t){return e===(void 0!==t)}},$mod:function(e){var t=e[0],n=e[1];return function(e){return _anyIfArray(e,function(e){return e%t===n})}},$size:function(e){return function(t){return isArray(t)&&e===t.length}},$type:function(e){return function(t){return void 0===t?!1:_anyIfArray(t,function(t){return LocalCollection._f._type(t)===e})}},$regex:function(e,t){if(void 0!==t){if(/[^gim]/.test(t))throw new Error("Only the i, m, and g regexp options are supported");var n=e instanceof RegExp?e.source:e;e=new RegExp(n,t)}else e instanceof RegExp||(e=new RegExp(e));return function(t){return void 0===t?!1:_anyIfArray(t,function(t){return e.test(t)})}},$options:function(){return function(){return!0}},$elemMatch:function(e){var t=compileDocumentSelector(e);return function(e){return isArray(e)?_.any(e,function(e){return t(e)}):!1}},$not:function(e){var t=compileValueSelector(e);return function(e){return!t(e)}}};LocalCollection._f={_type:function(e){return"number"==typeof e?1:"string"==typeof e?2:"boolean"==typeof e?8:isArray(e)?4:null===e?10:e instanceof RegExp?11:"function"==typeof e?13:e instanceof Date?9:EJSON.isBinary(e)?5:e instanceof Meteor.Collection.ObjectID?7:3},_equal:function(e,t){return EJSON.equals(e,t,{keyOrderSensitive:!0})},_typeorder:function(e){return[-1,1,2,3,4,5,-1,6,7,8,0,9,-1,100,2,100,1,8,1][e]},_cmp:function(e,t){if(void 0===e)return void 0===t?0:-1;if(void 0===t)return 1;var n=LocalCollection._f._type(e),r=LocalCollection._f._type(t),o=LocalCollection._f._typeorder(n),i=LocalCollection._f._typeorder(r);if(o!==i)return i>o?-1:1;if(n!==r)throw Error("Missing type coercion logic in _cmp");if(7===n&&(n=r=2,e=e.toHexString(),t=t.toHexString()),9===n&&(n=r=1,e=e.getTime(),t=t.getTime()),1===n)return e-t;if(2===r)return t>e?-1:e===t?0:1;if(3===n){var a=function(e){var t=[];for(var n in e)t.push(n),t.push(e[n]);return t};return LocalCollection._f._cmp(a(e),a(t))}if(4===n)for(var u=0;;u++){if(u===e.length)return u===t.length?0:-1;if(u===t.length)return 1;var l=LocalCollection._f._cmp(e[u],t[u]);if(0!==l)return l}if(5===n){if(e.length!==t.length)return e.length-t.length;for(u=0;u<e.length;u++){if(e[u]<t[u])return-1;if(e[u]>t[u])return 1}return 0}if(8===n)return e?t?0:1:t?-1:0;if(10===n)return 0;if(11===n)throw Error("Sorting not supported on regular expression");if(13===n)throw Error("Sorting not supported on Javascript code");throw Error("Unknown type to sort")}},LocalCollection._matches=function(e,t){return LocalCollection._compileSelector(e)(t)},LocalCollection._makeLookupFunction=function(e){var t,n,r,o=e.indexOf(".");if(-1===o)t=e;else{t=e.substr(0,o);var i=e.substr(o+1);n=LocalCollection._makeLookupFunction(i),r=/^\d+(\.|$)/.test(i)}return function(e){if(null==e)return[void 0];var o=e[t];return n?isArray(o)&&0===o.length?[void 0]:((!isArray(o)||r)&&(o=[o]),Array.prototype.concat.apply([],_.map(o,n))):[o]}};var compileDocumentSelector=function(e){var t=[];return _.each(e,function(e,n){if("$"===n.substr(0,1)){if(!_.has(LOGICAL_OPERATORS,n))throw new Error("Unrecognized logical operator: "+n);t.push(LOGICAL_OPERATORS[n](e))}else{var r=LocalCollection._makeLookupFunction(n),o=compileValueSelector(e);t.push(function(e){var t=r(e);return _.any(t,o)})}}),function(e){return _.all(t,function(t){return t(e)})}};LocalCollection._compileSelector=function(e){if(e instanceof Function)return function(t){return e.call(t)};if(LocalCollection._selectorIsId(e))return function(t){return EJSON.equals(t._id,e)};if(!e||"_id"in e&&!e._id)return function(){return!1};if("boolean"==typeof e||isArray(e)||EJSON.isBinary(e))throw new Error("Invalid selector: "+e);return compileDocumentSelector(e)},LocalCollection._compileSort=function(e){var t=[];if(e instanceof Array)for(var n=0;n<e.length;n++)"string"==typeof e[n]?t.push({lookup:LocalCollection._makeLookupFunction(e[n]),ascending:!0}):t.push({lookup:LocalCollection._makeLookupFunction(e[n][0]),ascending:"desc"!==e[n][1]});else{if("object"!=typeof e)throw Error("Bad sort specification: ",JSON.stringify(e));for(var r in e)t.push({lookup:LocalCollection._makeLookupFunction(r),ascending:e[r]>=0})}if(0===t.length)return function(){return 0};var o=function(e,t){var n,r=!0;return _.each(e,function(e){isArray(e)||(e=[e]),isArray(e)&&0===e.length&&(e=[void 0]),_.each(e,function(e){if(r)n=e,r=!1;else{var o=LocalCollection._f._cmp(n,e);(t&&o>0||!t&&0>o)&&(n=e)}})}),n};return function(e,n){for(var r=0;r<t.length;++r){var i=t[r],a=o(i.lookup(e),i.ascending),u=o(i.lookup(n),i.ascending),l=LocalCollection._f._cmp(a,u);if(0!==l)return i.ascending?l:-l}return 0}},define("lib/selector",function(){}),Meteor={},Meteor._noYieldsAllowed=function(e){return e()},Meteor._SynchronousQueue=function(){var e=this;e._tasks=[],e._running=!1},_.extend(Meteor._SynchronousQueue.prototype,{runTask:function(e){var t=this;if(!t.safeToRunTask())throw new Error("Could not synchronously run a task from a running task");t._tasks.push(e);var n=t._tasks;t._tasks=[],t._running=!0;try{for(;!_.isEmpty(n);){var r=n.shift();try{r()}catch(o){if(_.isEmpty(n))throw o;Meteor._debug("Exception in queued task: "+o.stack)}}}finally{t._running=!1}},queueTask:function(e){var t=this,n=_.isEmpty(t._tasks);t._tasks.push(e),n&&setTimeout(_.bind(t.flush,t),0)},flush:function(){var e=this;e.runTask(function(){})},drain:function(){var e=this;if(e.safeToRunTask())for(;!_.isEmpty(e._tasks);)e.flush()},safeToRunTask:function(){var e=this;return!e._running}}),define("lib/synch-queue",function(){}),LocalCollection._diffQueryChanges=function(e,t,n,r){e?LocalCollection._diffQueryOrderedChanges(t,n,r):LocalCollection._diffQueryUnorderedChanges(t,n,r)},LocalCollection._diffQueryUnorderedChanges=function(e,t,n){if(n.moved)throw new Error("_diffQueryUnordered called with a moved observer!");_.each(t,function(t){if(_.has(e,t._id)){var r=e[t._id];n.changed&&!EJSON.equals(r,t)&&n.changed(t._id,LocalCollection._makeChangedFields(t,r))}else{var o=EJSON.clone(t);delete o._id,n.added&&n.added(t._id,o)}}),n.removed&&_.each(e,function(e){_.has(t,e._id)||n.removed(e._id)})},LocalCollection._diffQueryOrderedChanges=function(e,t,n){var r={};_.each(t,function(e){r[e._id]&&Meteor._debug("Duplicate _id in new_results"),r[e._id]=!0});var o={};_.each(e,function(e,t){e._id in o&&Meteor._debug("Duplicate _id in old_results"),o[e._id]=t});for(var i=[],a=0,u=t.length,l=new Array(u),c=new Array(u),s=function(e){return o[t[e]._id]},f=0;u>f;f++)if(void 0!==o[t[f]._id]){for(var d=a;d>0&&!(s(l[d-1])<s(f));)d--;c[f]=0===d?-1:l[d-1],l[d]=f,d+1>a&&(a=d+1)}for(var h=0===a?-1:l[a-1];h>=0;)i.push(h),h=c[h];i.reverse(),i.push(t.length),_.each(e,function(e){r[e._id]||n.removed&&n.removed(e._id)});var p=0;_.each(i,function(r){for(var i,a,u,l=t[r]?t[r]._id:null,c=p;r>c;c++)a=t[c],_.has(o,a._id)?(i=e[o[a._id]],u=LocalCollection._makeChangedFields(a,i),_.isEmpty(u)||n.changed&&n.changed(a._id,u),n.movedBefore&&n.movedBefore(a._id,l)):(u=EJSON.clone(a),delete u._id,n.addedBefore&&n.addedBefore(a._id,u,l),n.added&&n.added(a._id,u));l&&(a=t[r],i=e[o[a._id]],u=LocalCollection._makeChangedFields(a,i),_.isEmpty(u)||n.changed&&n.changed(a._id,u)),p=r+1})},LocalCollection._diffObjects=function(e,t,n){_.each(e,function(e,r){_.has(t,r)?n.both&&n.both(r,e,t[r]):n.leftOnly&&n.leftOnly(r,e)}),n.rightOnly&&_.each(t,function(t,r){_.has(e,r)||n.rightOnly(r,t)})},define("lib/diff",function(){}),define("backbone-mongo-solo",[],function(){var e=[],t=e.push,n=e.slice,r=e.splice;Backbone.Mongo=Backbone.Collection.extend({model:Backbone.Model,initialize:function(){},toJSON:function(e){return this.map(function(t){return t.toJSON(e)})},sync:function(){return Backbone.sync.apply(this,arguments)},add:function(e,t){return this.set(e,_.defaults(t||{},{add:!0,merge:!1,remove:!1}))},remove:function(e,t){var n;n=_.isArray(e)?_.any(e,function(e){return e===this._prepareModel(e)},this):e===this._prepareModel(e),e=n?_.isArray(e)?e.slice():[e]:this.store.find(e).fetch(),t||(t={});var r,o,i,a;for(r=0,o=e.length;o>r;r++)if(a=this.get(e[r])){if(_.isEmpty(e)||!arguments.length)return this._reset(),void 0;delete this._byId[a.id],delete this._byId[a.cid],i=this.indexOf(a),this.models.splice(i,1),this.store.remove({cid:a.cid}),this.length--,t.silent||(t.index=i,a.trigger("remove",a,this,t)),this._removeReference(a)}return this},set:function(e,n){n=_.defaults(n||{}),n.parse&&(e=this.parse(e,n)),_.isArray(e)||(e=e?[e]:[]);var o,i,a,u,l,c=n.at,s=this.comparator&&null==c&&n.sort!==!1,f=_.isString(this.comparator)?this.comparator:null,d=[],h=[],p={};for(o=0,i=e.length;i>o;o++)(a=this._prepareModel(e[o],n))&&((u=this.get(a))?(n.remove&&(p[u.cid]=!0),n.merge&&(u.set(a.attributes,n),s&&!l&&u.hasChanged(f)&&(l=!0))):n.add&&(d.push(a),a.on("all",this._onModelEvent,this),this._byId[a.cid]=a,null!=a.id&&(this._byId[a.id]=a)));if(n.remove){for(o=0,i=this.length;i>o;++o)p[(a=this.models[o]).cid]||h.push(a);h.length&&this.remove(h,n)}if(d.length)if(s&&(l=!0),this.length+=d.length,null!=c){this.store.remove({});var v=_.head(this.models,c).concat(d).concat(_.tail(this.models,c));this._normalizedInsert(v),r.apply(this.models,[c,0].concat(d))}else this._normalizedInsert(d),t.apply(this.models,d);if(l&&this.sort({silent:!0}),n.silent)return this;for(o=0,i=d.length;i>o;o++)(a=d[o]).trigger("add",a,this,n);return l&&this.trigger("sort",this,n),this},reset:function(e,t){t||(t={});for(var n=0,r=this.models.length;r>n;n++)this._removeReference(this.models[n]);return t.previousModels=this.models,this._reset(),this.add(e,_.extend({silent:!0},t)),t.silent||this.trigger("reset",this,t),this},push:function(e,t){return e=this._prepareModel(e,t),this.add(e,_.extend({at:this.length},t)),e},pop:function(e){var t=this.at(this.length-1);return this.remove(t,e),t},unshift:function(e,t){return e=this._prepareModel(e,t),this.add(e,_.extend({at:0},t)),e},shift:function(e){var t=this.at(0);return this.remove(t,e),t},slice:function(e,t){return this.models.slice(e,t)},get:function(e){return null==e?void 0:this._byId[null!=e.id?e.id:e.cid||e]},at:function(e){return this.models[e]},where:function(e,t){if(_.isEmpty(e))return t?void 0:[];var n=function(t){for(var n in e)if(e[n]!==t.get(n))return!1;return!0};return t?_.find(this.models,n):this.filter(n)},findWhere:function(e){return this.where(e,!0)},sort:function(e){if(!this.comparator)throw new Error("Cannot sort a set without a comparator");return e||(e={}),_.isString(this.comparator)||1===this.comparator.length?this.models=this.sortBy(this.comparator,this):this.models.sort(_.bind(this.comparator,this)),this.store.remove({}),this._normalizedInsert(this.models),e.silent||this.trigger("sort",this,e),this},sortedIndex:function(e,t,n){t||(t=this.comparator);var r=_.isFunction(t)?t:function(e){return e.get(t)};return _.sortedIndex(this.models,e,r,n)},pluck:function(e){return _.invoke(this.models,"get",e)},fetch:function(e){e=e?_.clone(e):{},void 0===e.parse&&(e.parse=!0);var t=e.success,n=this;return e.success=function(r){var o=e.reset?"reset":"set";n[o](r,e),t&&t(n,r,e),n.trigger("sync",n,r,e)},this.sync("read",this,e)},create:function(e,t){if(t=t?_.clone(t):{},!(e=this._prepareModel(e,t)))return!1;t.wait||this.add(e,t);var n=this,r=t.success;return t.success=function(o){t.wait&&n.add(e,t),r&&r(e,o,t)},e.save(null,t),e},parse:function(e){return e},clone:function(){return new this.constructor(this.models)},_reset:function(){this.length=0,this.models=[],this.store=new LocalCollection,this._byId={}},_prepareModel:function(e,t){if(e instanceof Backbone.Model)return e.collection||(e.collection=this),e;t||(t={}),t.collection=this;var n=new this.model(e,t);return n._validate(e,t)?n:(this.trigger("invalid",this,e,t),!1)},_removeReference:function(e){this===e.collection&&delete e.collection,e.off("all",this._onModelEvent,this)},_onModelEvent:function(e,t,n,r){if("add"!==e&&"remove"!==e||n===this){if("destroy"===e&&this.remove(t,r),r&&!r.fromUpdate&&t&&/change\:/.test(e)){var o=/change\:(.*)/.exec(e)[1],i=n,a={};a[o]=i,this.store.update({cid:t.cid},{$set:a})}t&&e==="change:"+t.idAttribute&&(delete this._byId[t.previous(t.idAttribute)],null!=t.id&&(this._byId[t.id]=t)),this.trigger.apply(this,arguments)}},insert:function(e,t){return this.add(e,t)},find:function(e,t){if(_.isFunction(e))return _.find(this.models,e,t);var n=this.store.find(e||{},t).fetch(),r=_.pluck(n,"cid"),o=_.map(r,function(e){return this._byId[e]},this);return o},findOne:function(e,t){var n=this.store.findOne(e||{},t);return n?this._byId[n.cid]:[]},update:function(e,t,n){n=n?n:{multi:!1};var r=this.store.find(e).map(function(e){return e.cid});this.store.update(e,t,n),_.each(r,function(e){var t=this._byId[e],n=this.store.findOne({cid:e}),r=_.omit(n,["cid","_id"]);t.set(r,{fromUpdate:!0})},this)},_normalizedInsert:function(e){_.each(e,function(e){this.store.insert(_.extend(e.toJSON(),{cid:e.cid}))},this)}});var o=["forEach","each","map","collect","reduce","foldl","inject","reduceRight","foldr","find","detect","filter","select","reject","every","all","some","any","include","contains","invoke","max","min","toArray","size","first","head","take","initial","rest","tail","drop","last","without","indexOf","shuffle","lastIndexOf","isEmpty","chain"];_.each(o,function(e){Backbone.Collection.prototype[e]=function(){var t=n.call(arguments);return t.unshift(this.models),_[e].apply(_,t)}});var i=["groupBy","countBy","sortBy"];return _.each(i,function(e){Backbone.Collection.prototype[e]=function(t,n){var r=_.isFunction(t)?t:function(e){return e.get(t)};return _[e](this.models,r,n)}}),Backbone.Mongo});