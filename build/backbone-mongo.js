!function(e,t){"function"==typeof define&&define.amd?define(t):e.libGlobalName=t()}(this,function(){var e,t,n;!function(r){function o(e,t){return C.call(e,t)}function i(e,t){var n,r,o,i,l,c,a,u,s,f,d=t&&t.split("/"),_=y.map,h=_&&_["*"]||{};if(e&&"."===e.charAt(0))if(t){for(d=d.slice(0,d.length-1),e=d.concat(e.split("/")),u=0;u<e.length;u+=1)if(f=e[u],"."===f)e.splice(u,1),u-=1;else if(".."===f){if(1===u&&(".."===e[2]||".."===e[0]))break;u>0&&(e.splice(u-1,2),u-=2)}e=e.join("/")}else 0===e.indexOf("./")&&(e=e.substring(2));if((d||h)&&_){for(n=e.split("/"),u=n.length;u>0;u-=1){if(r=n.slice(0,u).join("/"),d)for(s=d.length;s>0;s-=1)if(o=_[d.slice(0,s).join("/")],o&&(o=o[r])){i=o,l=u;break}if(i)break;!c&&h&&h[r]&&(c=h[r],a=u)}!i&&c&&(i=c,l=a),i&&(n.splice(0,l,i),e=n.join("/"))}return e}function l(e,t){return function(){return _.apply(r,b.call(arguments,0).concat([e,t]))}}function c(e){return function(t){return i(t,e)}}function a(e){return function(t){v[e]=t}}function u(e){if(o(m,e)){var t=m[e];delete m[e],g[e]=!0,d.apply(r,t)}if(!o(v,e)&&!o(g,e))throw new Error("No "+e);return v[e]}function s(e){var t,n=e?e.indexOf("!"):-1;return n>-1&&(t=e.substring(0,n),e=e.substring(n+1,e.length)),[t,e]}function f(e){return function(){return y&&y.config&&y.config[e]||{}}}var d,_,h,p,v={},m={},y={},g={},C=Object.prototype.hasOwnProperty,b=[].slice;h=function(e,t){var n,r=s(e),o=r[0];return e=r[1],o&&(o=i(o,t),n=u(o)),o?e=n&&n.normalize?n.normalize(e,c(t)):i(e,t):(e=i(e,t),r=s(e),o=r[0],e=r[1],o&&(n=u(o))),{f:o?o+"!"+e:e,n:e,pr:o,p:n}},p={require:function(e){return l(e)},exports:function(e){var t=v[e];return"undefined"!=typeof t?t:v[e]={}},module:function(e){return{id:e,uri:"",exports:v[e],config:f(e)}}},d=function(e,t,n,i){var c,s,f,d,_,y,C=[];if(i=i||e,"function"==typeof n){for(t=!t.length&&n.length?["require","exports","module"]:t,_=0;_<t.length;_+=1)if(d=h(t[_],i),s=d.f,"require"===s)C[_]=p.require(e);else if("exports"===s)C[_]=p.exports(e),y=!0;else if("module"===s)c=C[_]=p.module(e);else if(o(v,s)||o(m,s)||o(g,s))C[_]=u(s);else{if(!d.p)throw new Error(e+" missing "+s);d.p.load(d.n,l(i,!0),a(s),{}),C[_]=v[s]}f=n.apply(v[e],C),e&&(c&&c.exports!==r&&c.exports!==v[e]?v[e]=c.exports:f===r&&y||(v[e]=f))}else e&&(v[e]=n)},e=t=_=function(e,t,n,o,i){return"string"==typeof e?p[e]?p[e](t):u(h(e,t).f):(e.splice||(y=e,t.splice?(e=t,t=n,n=null):e=r),t=t||function(){},"function"==typeof n&&(n=o,o=i),o?d(r,e,t,n):setTimeout(function(){d(r,e,t,n)},4),_)},_.config=function(e){return y=e,y.deps&&_(y.deps,y.callback),_},n=function(e,t,n){t.splice||(n=t,t=[]),o(v,e)||o(m,e)||(m[e]=[e,t,n])},n.amd={jQuery:!0}}(),n("components/almond",function(){}),Deps={},Deps.active=!1,Deps.currentComputation=null;var r=function(e){Deps.currentComputation=e,Deps.active=!!e},o=function(){return"undefined"!=typeof Meteor?Meteor._debug:"undefined"!=typeof console&&console.log?console.log:function(){}},i=1,l=[],c=!1,a=!1,u=!1,s=[],f=function(){c||(setTimeout(Deps.flush,0),c=!0)},d=!1;Deps.Computation=function(e,t){if(!d)throw new Error("Deps.Computation constructor is private; use Deps.autorun");d=!1;var n=this;n.stopped=!1,n.invalidated=!1,n.firstRun=!0,n._id=i++,n._onInvalidateCallbacks=[],n._parent=t,n._func=e,n._recomputing=!1;var r=!0;try{n._compute(),r=!1}finally{n.firstRun=!1,r&&n.stop()}},_.extend(Deps.Computation.prototype,{onInvalidate:function(e){var t=this;if("function"!=typeof e)throw new Error("onInvalidate requires a function");var n=function(){Deps.nonreactive(function(){e(t)})};t.invalidated?n():t._onInvalidateCallbacks.push(n)},invalidate:function(){var e=this;if(!e.invalidated){e._recomputing||e.stopped||(f(),l.push(this)),e.invalidated=!0;for(var t,n=0;t=e._onInvalidateCallbacks[n];n++)t();e._onInvalidateCallbacks=[]}},stop:function(){this.stopped||(this.stopped=!0,this.invalidate())},_compute:function(){var e=this;e.invalidated=!1;var t=Deps.currentComputation;r(e),u=!0;try{e._func(e)}finally{r(t),u=!1}},_recompute:function(){var e=this;for(e._recomputing=!0;e.invalidated&&!e.stopped;)try{e._compute()}catch(t){o()("Exception from Deps recompute:",t.stack||t.message)}e._recomputing=!1}}),Deps.Dependency=function(){this._dependentsById={}},_.extend(Deps.Dependency.prototype,{depend:function(e){if(!e){if(!Deps.active)return!1;e=Deps.currentComputation}var t=this,n=e._id;return n in t._dependentsById?!1:(t._dependentsById[n]=e,e.onInvalidate(function(){delete t._dependentsById[n]}),!0)},changed:function(){var e=this;for(var t in e._dependentsById)e._dependentsById[t].invalidate()},hasDependents:function(){var e=this;for(var t in e._dependentsById)return!0;return!1}}),_.extend(Deps,{flush:function(){if(a)throw new Error("Can't call Deps.flush while flushing");if(u)throw new Error("Can't flush inside Deps.autorun");for(a=!0,c=!0;l.length||s.length;){var e=l;l=[];for(var t,n=0;t=e[n];n++)t._recompute();if(s.length){var r=s.shift();try{r()}catch(i){o()("Exception from Deps afterFlush function:",i.stack||i.message)}}}a=!1,c=!1},autorun:function(e){if("function"!=typeof e)throw new Error("Deps.autorun requires a function argument");d=!0;var t=new Deps.Computation(e,Deps.currentComputation);return Deps.active&&Deps.onInvalidate(function(){t.stop()}),t},nonreactive:function(e){var t=Deps.currentComputation;r(null);try{return e()}finally{r(t)}},_makeNonreactive:function(e){if(e.$isNonreactive)return e;var t=function(){var t,n=this,r=_.toArray(arguments);return Deps.nonreactive(function(){t=e.apply(n,r)}),t};return t.$isNonreactive=!0,t},onInvalidate:function(e){if(!Deps.active)throw new Error("Deps.onInvalidate requires a currentComputation");Deps.currentComputation.onInvalidate(e)},afterFlush:function(e){s.push(e),f()}}),n("lib/deps",function(){});var h=function(e,t,n,r){return{key:e,value:t,next:n,prev:r}};OrderedDict=function(){var e=this;e._dict={},e._first=null,e._last=null,e._size=0;var t=_.toArray(arguments);e._stringify=function(e){return e},"function"==typeof t[0]&&(e._stringify=t.shift()),_.each(t,function(t){e.putBefore(t[0],t[1],null)})},_.extend(OrderedDict.prototype,{_k:function(e){return" "+this._stringify(e)},empty:function(){var e=this;return!e._first},size:function(){var e=this;return e._size},_linkEltIn:function(e){var t=this;e.next?(e.prev=e.next.prev,e.next.prev=e,e.prev&&(e.prev.next=e)):(e.prev=t._last,t._last&&(t._last.next=e),t._last=e),(null===t._first||t._first===e.next)&&(t._first=e)},_linkEltOut:function(e){var t=this;e.next&&(e.next.prev=e.prev),e.prev&&(e.prev.next=e.next),e===t._last&&(t._last=e.prev),e===t._first&&(t._first=e.next)},putBefore:function(e,t,n){var r=this;if(r._dict[r._k(e)])throw new Error("Item "+e+" already present in OrderedDict");var o=n?h(e,t,r._dict[r._k(n)]):h(e,t,null);if(void 0===o.next)throw new Error("could not find item to put this one before");r._linkEltIn(o),r._dict[r._k(e)]=o,r._size++},append:function(e,t){var n=this;n.putBefore(e,t,null)},remove:function(e){var t=this,n=t._dict[t._k(e)];if(void 0===n)throw new Error("Item "+e+" not present in OrderedDict");return t._linkEltOut(n),t._size--,delete t._dict[t._k(e)],n.value},get:function(e){var t=this;return t.has(e)?t._dict[t._k(e)].value:void 0},has:function(e){var t=this;return _.has(t._dict,t._k(e))},forEach:function(e){for(var t=this,n=0,r=t._first;null!==r;){var o=e(r.value,r.key,n);if(o===OrderedDict.BREAK)return;r=r.next,n++}},first:function(){var e=this;return e.empty()?void 0:e._first.key},firstValue:function(){var e=this;return e.empty()?void 0:e._first.value},last:function(){var e=this;return e.empty()?void 0:e._last.key},lastValue:function(){var e=this;return e.empty()?void 0:e._last.value},prev:function(e){var t=this;if(t.has(e)){var n=t._dict[t._k(e)];if(n.prev)return n.prev.key}return null},next:function(e){var t=this;if(t.has(e)){var n=t._dict[t._k(e)];if(n.next)return n.next.key}return null},moveBefore:function(e,t){var n=this,r=n._dict[n._k(e)],o=t?n._dict[n._k(t)]:null;if(void 0===r)throw new Error("Item to move is not present");if(void 0===o)throw new Error("Could not find element to move this one before");o!==r.next&&(n._linkEltOut(r),r.next=o,n._linkEltIn(r))},indexOf:function(e){var t=this,n=null;return t.forEach(function(r,o,i){return t._k(o)===t._k(e)?(n=i,OrderedDict.BREAK):void 0}),n},_checkRep:function(){var e=this;_.each(e._dict,function(e,t){if(t.next===t)throw new Error("Next is a loop");if(t.prev===t)throw new Error("Prev is a loop")})}}),OrderedDict.BREAK={"break":!0},n("lib/ordered_dict",function(){}),LocalCollection=function(e){this.name=e,this.docs={},this._observeQueue=new Meteor._SynchronousQueue,this.next_qid=1,this.queries={},this._savedOriginals=null,this.paused=!1},LocalCollection._applyChanges=function(e,t){_.each(t,function(t,n){void 0===t?delete e[n]:e[n]=t})};var p=function(e){var t=new Error(e);return t.name="MinimongoError",t};LocalCollection.prototype.find=function(e,t){return 0===arguments.length&&(e={}),t._byId&&!this._byId&&(this._byId=t._byId),new LocalCollection.Cursor(this,e,t)},LocalCollection.Cursor=function(e,t,n){var r=this;n||(n={}),this._byId=n._byId||[],this.collection=e,LocalCollection._selectorIsId(t)?(r.selector_id=LocalCollection._idStringify(t),r.selector_f=LocalCollection._compileSelector(t),r.sort_f=void 0):(r.selector_id=void 0,r.selector_f=LocalCollection._compileSelector(t),r.sort_f=n.sort?LocalCollection._compileSort(n.sort):null),r.skip=n.skip,r.limit=n.limit,r.fields=n.fields,r.fields&&(r.projection_f=LocalCollection._compileProjection(r.fields)),r._transform=n.transform&&"undefined"!=typeof Deps?Deps._makeNonreactive(n.transform):n.transform,r.db_objects=null,r.cursor_pos=0,"undefined"!=typeof Deps&&(r.reactive=void 0===n.reactive?!0:n.reactive)},LocalCollection.Cursor.prototype.rewind=function(){var e=this;e.db_objects=null,e.cursor_pos=0},LocalCollection.prototype.findOne=function(e,t){return 0===arguments.length&&(e={}),t=t||{},t.limit=1,this.find(e,t).fetch()[0]},LocalCollection.Cursor.prototype.forEach=function(e){var t=this;for(null===t.db_objects&&(t.db_objects=t._getRawObjects(!0)),t.reactive&&t._depend({addedBefore:!0,removed:!0,changed:!0,movedBefore:!0});t.cursor_pos<t.db_objects.length;){var n=EJSON.clone(t.db_objects[t.cursor_pos++]);n=t._byId[n.cid],t.projection_f&&(n=t.projection_f(n)),t._transform&&(n=t._transform(n)),e(n)}},LocalCollection.Cursor.prototype.getTransform=function(){var e=this;return e._transform},LocalCollection.Cursor.prototype.map=function(e){var t=this,n=[];return t.forEach(function(r){r=t._byId[r.cid],n.push(e(r))}),n},LocalCollection.Cursor.prototype.fetch=function(){var e=this,t=[];return e.forEach(function(n){n&&(n=e._byId[n.cid]),t.push(n)}),t},LocalCollection.Cursor.prototype.count=function(){var e=this;return e.reactive&&e._depend({added:!0,removed:!0}),null===e.db_objects&&(e.db_objects=e._getRawObjects(!0)),e.db_objects.length},LocalCollection.Cursor.prototype._publishCursor=function(e){var t=this;if(!t.collection.name)throw new Error("Can't publish a cursor from a collection without a name.");var n=t.collection.name;return Meteor.Collection._publishCursor(t,e,n)},LocalCollection._isOrderedChanges=function(e){if(e.added&&e.addedBefore)throw new Error("Please specify only one of added() and addedBefore()");return"function"==typeof e.addedBefore||"function"==typeof e.movedBefore},LocalCollection.LiveResultsSet=function(){},_.extend(LocalCollection.Cursor.prototype,{observe:function(e){var t=this;return LocalCollection._observeFromObserveChanges(t,e)},observeChanges:function(e){var t=this,n=LocalCollection._isOrderedChanges(e);if(!n&&(t.skip||t.limit))throw new Error("must use ordered observe with skip or limit");var r,o={selector_f:t.selector_f,sort_f:n&&t.sort_f,results_snapshot:null,ordered:n,cursor:t,observeChanges:e.observeChanges,fields:t.fields,projection_f:t.projection_f};t.reactive&&(r=t.collection.next_qid++,t.collection.queries[r]=o),o.results=t._getRawObjects(n),t.collection.paused&&(o.results_snapshot=n?[]:{});var i=function(e,n,r){return e?function(){var o=this,i=arguments;void 0!==n&&t.projection_f&&(i[n]=t.projection_f(i[n]),r&&_.isEmpty(i[n]))||t.collection.paused||t.collection._observeQueue.queueTask(function(){e.apply(o,i)})}:function(){}};o.added=i(e.added,1),o.changed=i(e.changed,1,!0),o.removed=i(e.removed),n&&(o.moved=i(e.moved),o.addedBefore=i(e.addedBefore,1),o.movedBefore=i(e.movedBefore)),e._suppress_initial||t.collection.paused||_.each(o.results,function(e){var t=EJSON.clone(e);delete t._id,n&&o.addedBefore(e._id,t,null),o.added(e._id,t)});var l=new LocalCollection.LiveResultsSet;return _.extend(l,{collection:t.collection,stop:function(){t.reactive&&delete t.collection.queries[r]}}),t.reactive&&Deps.active&&Deps.onInvalidate(function(){l.stop()}),t.collection._observeQueue.drain(),l}}),LocalCollection.Cursor.prototype._getRawObjects=function(e){var t=this,n=e?[]:{};if(t.selector_id){if(t.skip)return n;if(_.has(t.collection.docs,t.selector_id)){var r=t.collection.docs[t.selector_id];e?n.push(r):n[t.selector_id]=r}return n}for(var o in t.collection.docs){var i=t.collection.docs[o];if(t.selector_f(i)&&(e?n.push(i):n[o]=i),t.limit&&!t.skip&&!t.sort_f&&n.length===t.limit)return n}if(!e)return n;t.sort_f&&n.sort(t.sort_f);var l=t.skip||0,c=t.limit?t.limit+l:n.length;return n.slice(l,c)},LocalCollection.Cursor.prototype._depend=function(e){var t=this;if(Deps.active){var n=new Deps.Dependency;n.depend();var r=_.bind(n.changed,n),o={_suppress_initial:!0};_.each(["added","changed","removed","addedBefore","movedBefore"],function(t){e[t]&&(o[t]=r)}),t.observeChanges(o)}},LocalCollection.prototype.insert=function(e,t){var n=this;if(_.isArray(e))return _.each(e,_.bind(n.insert,n));e=EJSON.clone(e),_.has(e,"_id")||(e._id=LocalCollection._useOID?new LocalCollection._ObjectID:Random.id());var r=LocalCollection._idStringify(e._id);if(_.has(n.docs,e._id))throw p("Duplicate _id '"+e._id+"'");n._saveOriginal(r,void 0),n.docs[r]=e;var o=[];for(var i in n.queries){var l=n.queries[i];l.selector_f(e)&&(l.cursor.skip||l.cursor.limit?o.push(i):LocalCollection._insertInResults(l,e))}return _.each(o,function(e){n.queries[e]&&LocalCollection._recomputeResults(n.queries[e])}),n._observeQueue.drain(),t&&Meteor.defer(function(){t(null,e._id)}),e._id},LocalCollection.prototype.remove=function(e,t){var n=this,r=[],o=[],i=LocalCollection._compileSelector(e),l=LocalCollection._idsMatchedBySelector(e);if(l)_.each(l,function(e){var t=LocalCollection._idStringify(e);_.has(n.docs,t)&&i(n.docs[t])&&r.push(t)});else for(var c in n.docs){var a=n.docs[c];i(a)&&r.push(c)}for(var u=[],s=0;s<r.length;s++){var f=r[s],d=n.docs[f];_.each(n.queries,function(e,t){e.selector_f(d)&&(e.cursor.skip||e.cursor.limit?o.push(t):u.push({qid:t,doc:d}))}),n._saveOriginal(f,d),delete n.docs[f]}_.each(u,function(e){var t=n.queries[e.qid];t&&LocalCollection._removeFromResults(t,e.doc)}),_.each(o,function(e){var t=n.queries[e];t&&LocalCollection._recomputeResults(t)}),n._observeQueue.drain(),t&&Meteor.defer(t)},LocalCollection.prototype.update=function(e,t,n,r){var o=this;if(!this._byId&&n._byId&&(this._byId=n._byId||[]),!r&&n instanceof Function&&(r=n,n=null),n||(n={}),n.upsert)throw new Error("upsert not yet implemented");var i=LocalCollection._compileSelector(e),l={};_.each(o.queries,function(e,t){!e.cursor.skip&&!e.cursor.limit||e.paused||(l[t]=EJSON.clone(e.results))});var c={};for(var a in o.docs){var u=o.docs[a];if(i(u)&&(o._saveOriginal(a,u),o._modifyAndNotify(u,t,c),!n.multi))break}_.each(c,function(e,t){var n=o.queries[t];n&&LocalCollection._recomputeResults(n,l[t])}),o._observeQueue.drain()},LocalCollection.prototype._modifyAndNotify=function(e,t,n){var r=this,o={};for(var i in r.queries){var l=r.queries[i];o[i]=l.ordered?l.selector_f(e):_.has(l.results,LocalCollection._idStringify(e._id))}var c=EJSON.clone(e);LocalCollection._modify(e,t);var a=_.omit(e,["cid","_id"]),u=this._byId[e.cid];if(!u)throw new Error("Model mismatch during update");u.set(a,{fromUpdate:!0});for(i in r.queries){l=r.queries[i];var s=o[i],f=l.selector_f(e);l.cursor.skip||l.cursor.limit?(s||f)&&(n[i]=!0):s&&!f?LocalCollection._removeFromResults(l,e):!s&&f?LocalCollection._insertInResults(l,e):s&&f&&LocalCollection._updateInResults(l,e,c)}},LocalCollection._insertInResults=function(e,t){var n=EJSON.clone(t);if(delete n._id,e.ordered){if(e.sort_f){var r=LocalCollection._insertInSortedList(e.sort_f,e.results,t),o=e.results[r+1];o=o?o._id:null,e.addedBefore(t._id,n,o)}else e.addedBefore(t._id,n,null),e.results.push(t);e.added(t._id,n)}else e.added(t._id,n),e.results[LocalCollection._idStringify(t._id)]=t},LocalCollection._removeFromResults=function(e,t){if(e.ordered){var n=LocalCollection._findInOrderedResults(e,t);e.removed(t._id),e.results.splice(n,1)}else{var r=LocalCollection._idStringify(t._id);e.removed(t._id),delete e.results[r]}},LocalCollection._updateInResults=function(e,t,n){if(!EJSON.equals(t._id,n._id))throw new Error("Can't change a doc's _id while updating");var r=LocalCollection._makeChangedFields(t,n);if(!e.ordered)return _.isEmpty(r)||(e.changed(t._id,r),e.results[LocalCollection._idStringify(t._id)]=t),void 0;var o=LocalCollection._findInOrderedResults(e,t);if(_.isEmpty(r)||e.changed(t._id,r),e.sort_f){e.results.splice(o,1);var i=LocalCollection._insertInSortedList(e.sort_f,e.results,t);if(o!==i){var l=e.results[i+1];l=l?l._id:null,e.movedBefore&&e.movedBefore(t._id,l)}}},LocalCollection._recomputeResults=function(e,t){t||(t=e.results),e.results=e.cursor._getRawObjects(e.ordered),e.paused||LocalCollection._diffQueryChanges(e.ordered,t,e.results,e)},LocalCollection._findInOrderedResults=function(e,t){if(!e.ordered)throw new Error("Can't call _findInOrderedResults on unordered query");for(var n=0;n<e.results.length;n++)if(e.results[n]===t)return n;throw Error("object missing from query")},LocalCollection._binarySearch=function(e,t,n){for(var r=0,o=t.length;o>0;){var i=Math.floor(o/2);e(n,t[r+i])>=0?(r+=i+1,o-=i+1):o=i}return r},LocalCollection._insertInSortedList=function(e,t,n){if(0===t.length)return t.push(n),0;var r=LocalCollection._binarySearch(e,t,n);return t.splice(r,0,n),r},LocalCollection.prototype.saveOriginals=function(){var e=this;if(e._savedOriginals)throw new Error("Called saveOriginals twice without retrieveOriginals");e._savedOriginals={}},LocalCollection.prototype.retrieveOriginals=function(){var e=this;if(!e._savedOriginals)throw new Error("Called retrieveOriginals without saveOriginals");var t=e._savedOriginals;return e._savedOriginals=null,t},LocalCollection.prototype._saveOriginal=function(e,t){var n=this;n._savedOriginals&&(_.has(n._savedOriginals,e)||(n._savedOriginals[e]=EJSON.clone(t)))},LocalCollection.prototype.pauseObservers=function(){if(!this.paused){this.paused=!0;for(var e in this.queries){var t=this.queries[e];t.results_snapshot=EJSON.clone(t.results)}}},LocalCollection.prototype.resumeObservers=function(){var e=this;if(this.paused){this.paused=!1;for(var t in this.queries){var n=e.queries[t];LocalCollection._diffQueryChanges(n.ordered,n.results_snapshot,n.results,n),n.results_snapshot=null}e._observeQueue.drain()}},LocalCollection._idStringify=function(e){if(e instanceof LocalCollection._ObjectID)return e.valueOf();if("string"==typeof e)return""===e?e:"-"===e.substr(0,1)||"~"===e.substr(0,1)||LocalCollection._looksLikeObjectID(e)||"{"===e.substr(0,1)?"-"+e:e;if(void 0===e)return"-";if("object"==typeof e&&null!==e)throw new Error("Meteor does not currently support objects other than ObjectID as ids");return"~"+JSON.stringify(e)},LocalCollection._idParse=function(e){return""===e?e:"-"===e?void 0:"-"===e.substr(0,1)?e.substr(1):"~"===e.substr(0,1)?JSON.parse(e.substr(1)):LocalCollection._looksLikeObjectID(e)?new LocalCollection._ObjectID(e):e},LocalCollection._makeChangedFields=function(e,t){var n={};return LocalCollection._diffObjects(t,e,{leftOnly:function(e){n[e]=void 0},rightOnly:function(e,t){n[e]=t},both:function(e,t,r){EJSON.equals(t,r)||(n[e]=r)}}),n},LocalCollection._observeFromObserveChanges=function(e,t){var n=e.getTransform();if(n||(n=function(e){return e}),t.addedAt&&t.added)throw new Error("Please specify only one of added() and addedAt()");if(t.changedAt&&t.changed)throw new Error("Please specify only one of changed() and changedAt()");if(t.removed&&t.removedAt)throw new Error("Please specify only one of removed() and removedAt()");return t.addedAt||t.movedTo||t.changedAt||t.removedAt?LocalCollection._observeOrderedFromObserveChanges(e,t,n):LocalCollection._observeUnorderedFromObserveChanges(e,t,n)},LocalCollection._observeUnorderedFromObserveChanges=function(e,t,n){var r={},o=!!t._suppress_initial,i=e.observeChanges({added:function(e,i){var l=LocalCollection._idStringify(e),c=EJSON.clone(i);c._id=e,r[l]=c,o||t.added&&t.added(n(c))},changed:function(e,i){var l=LocalCollection._idStringify(e),c=r[l],a=EJSON.clone(c);if(LocalCollection._applyChanges(c,i),!o&&t.changed)var u=n(c,"changedNew"),a=n(a,"changedOld");o||t.changed&&t.changed(u,a),a=void 0,delete a},removed:function(e){var i=LocalCollection._idStringify(e),l=r[i];delete r[i],o||t.removed&&t.removed(n(l))}});return o=!1,i},LocalCollection._observeOrderedFromObserveChanges=function(e,t,n){var r=new OrderedDict(LocalCollection._idStringify),o=!!t._suppress_initial,i=!t._no_indices,l=e.observeChanges({addedBefore:function(e,l,c){var a=EJSON.clone(l);if(a._id=e,r.putBefore(e,a,c||null),!o)if(t.addedAt){var u=i?r.indexOf(e):-1;c=c?r.get(c).cid:null,t.addedAt(n(EJSON.clone(a)),u,c)}else t.added&&t.added(n(EJSON.clone(a)))},changed:function(e,o){var l=r.get(e);if(!l)throw new Error("Unknown id for changed: "+e);var c=EJSON.clone(l);LocalCollection._applyChanges(l,o);var a=n(EJSON.clone(l),"changedNew"),u=n(c,"changedOld");if(t.changedAt){var s=i?r.indexOf(e):-1;t.changedAt(a,u,s)}else t.changed&&t.changed(a,u);u=void 0,delete u},movedBefore:function(e,o){var l,c=r.get(e);if(t.movedTo&&(l=i?r.indexOf(e):-1),r.moveBefore(e,o||null),t.movedTo){var a=i?r.indexOf(e):-1;o=o?r.get(o).cid:null,t.movedTo(n(EJSON.clone(c)),l,a,o||null)}else t.moved&&t.moved(n(EJSON.clone(c)))},removed:function(e){var o,l=r.get(e);t.removedAt&&(o=i?r.indexOf(e):-1),r.remove(e),t.removedAt&&t.removedAt(n(l),o),t.removed&&t.removed(n(l))}});return o=!1,l},LocalCollection._compileProjection=function(e){if(!_.isObject(e))throw p("fields option must be an object");var t=_.keys(e);if(_.each(t,function(e){_.each(t,function(t){var n=e.indexOf(t);if(e!==t&&!n&&"."===e[t.length])throw p("both "+e+" and "+t+" found in fields option, using both of them may trigger "+"unexpected behavior. Did you mean to use only one of them?")})}),_.any(_.values(e),function(e){return-1===_.indexOf([1,0,!0,!1],e)}))throw p("Projection values should be one of 1, 0, true, or false");var n=_.isUndefined(e._id)?!0:e._id;delete e._id;var r=null,o=[];return _.each(e,function(e,t){if(e=!!e,null===r&&(r=e),r!==e)throw p("You cannot currently mix including and excluding fields.");o.push(t.split("."))}),r?function(e){var t={};return _.each(o,function(n){for(var r=t,o=e,i=0;i<n.length-1;i++){var l=n[i];if(!_.has(r,l)){if(_.isArray(o[l])){r[l]=[],o=void 0;break}if(!_.isObject(o[l])){o=void 0;break}r[l]={}}r=r[l],o=o[l]}n.length>0&&o&&_.has(o,_.last(n))&&(r[_.last(n)]=o[_.last(n)])}),n&&_.has(e,"_id")&&(t._id=e._id),t}:function(e){var t=EJSON.clone(e);return _.each(o,function(n){for(var r=t,o=e,i=0;i<n.length-1;i++){var l=n[i];if(!_.has(r,l))break;r=r[l],o=o[l]}n.length>0&&delete r[_.last(n)]}),n||delete t._id,t}},n("minimongo",["lib/deps","lib/ordered_dict"],function(e){return function(){var t;return t||e.LocalCollection}}(this)),LocalCollection._modify=function(e,t){var n=!1;for(var r in t){n="$"===r.substr(0,1);break}var o;if(n){var o=EJSON.clone(e);for(var i in t){var l=LocalCollection._modifiers[i];if(!l)throw Error("Invalid modifier specified "+i);for(var c in t[i]){if(c.length&&"."===c[c.length-1])throw Error("Invalid mod field name, may not end in a period");var a=t[i][c],u=c.split("."),s=!!LocalCollection._noCreateModifiers[i],f="$rename"===i,d=LocalCollection._findModTarget(o,u,s,f),h=u.pop();l(d,h,a,c,o)}}}else{if(t._id&&!EJSON.equals(e._id,t._id))throw Error("Cannot change the _id of a document");for(var r in t){if("$"===r.substr(0,1))throw Error("When replacing document, field name may not start with '$'");if(/\./.test(r))throw Error("When replacing document, field name may not contain '.'")}o=t}_.each(_.keys(e),function(t){"_id"!==t&&delete e[t]});for(var r in o)e[r]=o[r]},LocalCollection._findModTarget=function(e,t,n,r){for(var o=0;o<t.length;o++){var i=o===t.length-1,l=t[o],c=/^[0-9]+$/.test(l);if(!(!n||"object"==typeof e&&l in e))return void 0;if(e instanceof Array){if(r)return null;if(!c)throw Error("can't append to array using string field name ["+l+"]");for(l=parseInt(l),i&&(t[o]=l);e.length<l;)e.push(null);if(!i)if(e.length===l)e.push({});else if("object"!=typeof e[l])throw Error("can't modify field '"+t[o+1]+"' of list value "+JSON.stringify(e[l]))}else i||l in e||(e[l]={});if(i)return e;e=e[l]}},LocalCollection._noCreateModifiers={$unset:!0,$pop:!0,$rename:!0,$pull:!0,$pullAll:!0},LocalCollection._modifiers={$inc:function(e,t,n){if("number"!=typeof n)throw Error("Modifier $inc allowed for numbers only");if(t in e){if("number"!=typeof e[t])throw Error("Cannot apply $inc modifier to non-number");e[t]+=n}else e[t]=n},$set:function(e,t,n){if("_id"===t&&!EJSON.equals(n,e._id))throw Error("Cannot change the _id of a document");e[t]=EJSON.clone(n)},$unset:function(e,t){void 0!==e&&(e instanceof Array?t in e&&(e[t]=null):delete e[t])},$push:function(e,t,n){var r=e[t];if(void 0===r)e[t]=[n];else{if(!(r instanceof Array))throw Error("Cannot apply $push modifier to non-array");r.push(EJSON.clone(n))}},$pushAll:function(e,t,n){if(!("object"==typeof n&&n instanceof Array))throw Error("Modifier $pushAll/pullAll allowed for arrays only");var r=e[t];if(void 0===r)e[t]=n;else{if(!(r instanceof Array))throw Error("Cannot apply $pushAll modifier to non-array");for(var o=0;o<n.length;o++)r.push(n[o])}},$addToSet:function(e,t,n){var r=e[t];if(void 0===r)e[t]=[n];else{if(!(r instanceof Array))throw Error("Cannot apply $addToSet modifier to non-array");var o=!1;if("object"==typeof n)for(var i in n){"$each"===i&&(o=!0);break}var l=o?n.$each:[n];_.each(l,function(e){for(var t=0;t<r.length;t++)if(LocalCollection._f._equal(e,r[t]))return;r.push(e)})}},$pop:function(e,t,n){if(void 0!==e){var r=e[t];if(void 0!==r){if(!(r instanceof Array))throw Error("Cannot apply $pop modifier to non-array");"number"==typeof n&&0>n?r.splice(0,1):r.pop()}}},$pull:function(e,t,n){if(void 0!==e){var r=e[t];if(void 0!==r){if(!(r instanceof Array))throw Error("Cannot apply $pull/pullAll modifier to non-array");var o=[];if("object"!=typeof n||n instanceof Array)for(var i=0;i<r.length;i++)LocalCollection._f._equal(r[i],n)||o.push(r[i]);else for(var l=LocalCollection._compileSelector(n),i=0;i<r.length;i++)l(r[i])||o.push(r[i]);e[t]=o}}},$pullAll:function(e,t,n){if(!("object"==typeof n&&n instanceof Array))throw Error("Modifier $pushAll/pullAll allowed for arrays only");if(void 0!==e){var r=e[t];if(void 0!==r){if(!(r instanceof Array))throw Error("Cannot apply $pull/pullAll modifier to non-array");for(var o=[],i=0;i<r.length;i++){for(var l=!1,c=0;c<n.length;c++)if(LocalCollection._f._equal(r[i],n[c])){l=!0;break}l||o.push(r[i])}e[t]=o}}},$rename:function(e,t,n,r,o){if(r===n)throw Error("$rename source must differ from target");if(null===e)throw Error("$rename source field invalid");if("string"!=typeof n)throw Error("$rename target must be a string");if(void 0!==e){var i=e[t];delete e[t];var l=n.split("."),c=LocalCollection._findModTarget(o,l,!1,!0);if(null===c)throw Error("$rename target field invalid");var a=l.pop();c[a]=i}},$bit:function(){throw Error("$bit is not supported")}},n("lib/minimongo-modify",function(){}),EJSON={};var v={};EJSON.addType=function(e,t){if(_.has(v,e))throw new Error("Type "+e+" already present");v[e]=t};var m=[{matchJSONValue:function(e){return _.has(e,"$date")&&1===_.size(e)},matchObject:function(e){return e instanceof Date},toJSONValue:function(e){return{$date:e.getTime()}},fromJSONValue:function(e){return new Date(e.$date)}},{matchJSONValue:function(e){return _.has(e,"$binary")&&1===_.size(e)},matchObject:function(e){return"undefined"!=typeof Uint8Array&&e instanceof Uint8Array||e&&_.has(e,"$Uint8ArrayPolyfill")},toJSONValue:function(e){return{$binary:EJSON._base64Encode(e)}},fromJSONValue:function(e){return EJSON._base64Decode(e.$binary)}},{matchJSONValue:function(e){return _.has(e,"$escape")&&1===_.size(e)},matchObject:function(e){return _.isEmpty(e)||_.size(e)>2?!1:_.any(m,function(t){return t.matchJSONValue(e)})},toJSONValue:function(e){var t={};return _.each(e,function(e,n){t[n]=EJSON.toJSONValue(e)}),{$escape:t}},fromJSONValue:function(e){var t={};return _.each(e.$escape,function(e,n){t[n]=EJSON.fromJSONValue(e)}),t}},{matchJSONValue:function(e){return _.has(e,"$type")&&_.has(e,"$value")&&2===_.size(e)},matchObject:function(e){return EJSON._isCustomType(e)},toJSONValue:function(e){return{$type:e.typeName(),$value:e.toJSONValue()}},fromJSONValue:function(e){var t=e.$type,n=v[t];return n(e.$value)}}];EJSON._isCustomType=function(e){return e&&"function"==typeof e.toJSONValue&&"function"==typeof e.typeName&&_.has(v,e.typeName())};var y=EJSON._adjustTypesToJSONValue=function(e){if(null===e)return null;var t=g(e);return void 0!==t?t:(_.each(e,function(t,n){if("object"==typeof t||void 0===t){var r=g(t);return r?(e[n]=r,void 0):(y(t),void 0)}}),e)},g=function(e){for(var t=0;t<m.length;t++){var n=m[t];if(n.matchObject(e))return n.toJSONValue(e)}return void 0};EJSON.toJSONValue=function(e){var t=g(e);return void 0!==t?t:("object"==typeof e&&(e=EJSON.clone(e),y(e)),e)};var C=EJSON._adjustTypesFromJSONValue=function(e){if(null===e)return null;var t=b(e);return t!==e?t:(_.each(e,function(t,n){if("object"==typeof t){var r=b(t);if(t!==r)return e[n]=r,void 0;C(t)}}),e)},b=function(e){if("object"==typeof e&&null!==e&&_.size(e)<=2&&_.all(e,function(e,t){return"string"==typeof t&&"$"===t.substr(0,1)}))for(var t=0;t<m.length;t++){var n=m[t];if(n.matchJSONValue(e))return n.fromJSONValue(e)}return e};EJSON.fromJSONValue=function(e){var t=b(e);return t===e&&"object"==typeof e?(e=EJSON.clone(e),C(e),e):t},EJSON.stringify=function(e){return JSON.stringify(EJSON.toJSONValue(e))},EJSON.parse=function(e){return EJSON.fromJSONValue(JSON.parse(e))},EJSON.isBinary=function(e){return!!("undefined"!=typeof Uint8Array&&e instanceof Uint8Array||e&&e.$Uint8ArrayPolyfill)},EJSON.equals=function(e,t,n){var r,o=!(!n||!n.keyOrderSensitive);if(e===t)return!0;if(!e||!t)return!1;if("object"!=typeof e||"object"!=typeof t)return!1;if(e instanceof Date&&t instanceof Date)return e.valueOf()===t.valueOf();if(EJSON.isBinary(e)&&EJSON.isBinary(t)){if(e.length!==t.length)return!1;for(r=0;r<e.length;r++)if(e[r]!==t[r])return!1;return!0}if("function"==typeof e.equals)return e.equals(t,n);if(e instanceof Array){if(!(t instanceof Array))return!1;if(e.length!==t.length)return!1;for(r=0;r<e.length;r++)if(!EJSON.equals(e[r],t[r],n))return!1;return!0}var i;if(o){var l=[];return _.each(t,function(e,t){l.push(t)}),r=0,i=_.all(e,function(e,o){return r>=l.length?!1:o!==l[r]?!1:EJSON.equals(e,t[l[r]],n)?(r++,!0):!1}),i&&r===l.length}return r=0,i=_.all(e,function(e,o){return _.has(t,o)?EJSON.equals(e,t[o],n)?(r++,!0):!1:!1}),i&&_.size(t)===r},EJSON.clone=function(e){var t;if("object"!=typeof e)return e;if(null===e)return null;if(e instanceof Date)return new Date(e.getTime());if(EJSON.isBinary(e)){t=EJSON.newBinary(e.length);for(var n=0;n<e.length;n++)t[n]=e[n];return t}if(_.isArray(e)||_.isArguments(e)){for(t=[],n=0;n<e.length;n++)t[n]=EJSON.clone(e[n]);return t}return"function"==typeof e.clone,t={},_.each(e,function(e,n){t[n]=EJSON.clone(e)}),t},n("lib/ejson",function(){}),LocalCollection._looksLikeObjectID=function(e){return 24===e.length&&e.match(/^[0-9a-f]*$/)},LocalCollection._ObjectID=function(e){var t=this;if(e){if(e=e.toLowerCase(),!LocalCollection._looksLikeObjectID(e))throw new Error("Invalid hexadecimal string for creating an ObjectID");
t._str=e}else t._str=Random.hexString(24)},LocalCollection._ObjectID.prototype.toString=function(){var e=this;return'ObjectID("'+e._str+'")'},LocalCollection._ObjectID.prototype.equals=function(e){var t=this;return e instanceof LocalCollection._ObjectID&&t.valueOf()===e.valueOf()},LocalCollection._ObjectID.prototype.clone=function(){var e=this;return new LocalCollection._ObjectID(e._str)},LocalCollection._ObjectID.prototype.typeName=function(){return"oid"},LocalCollection._ObjectID.prototype.getTimestamp=function(){var e=this;return parseInt(e._str.substr(0,8),16)},LocalCollection._ObjectID.prototype.valueOf=LocalCollection._ObjectID.prototype.toJSONValue=LocalCollection._ObjectID.prototype.toHexString=function(){return this._str},LocalCollection._selectorIsId=function(e){return"string"==typeof e||"number"==typeof e||e instanceof LocalCollection._ObjectID},LocalCollection._selectorIsIdPerhapsAsObject=function(e){return LocalCollection._selectorIsId(e)||e&&"object"==typeof e&&e._id&&LocalCollection._selectorIsId(e._id)&&1===_.size(e)},LocalCollection._idsMatchedBySelector=function(e){if(LocalCollection._selectorIsId(e))return[e];if(!e)return null;if(_.has(e,"_id"))return LocalCollection._selectorIsId(e._id)?[e._id]:e._id&&e._id.$in&&_.isArray(e._id.$in)&&!_.isEmpty(e._id.$in)&&_.all(e._id.$in,LocalCollection._selectorIsId)?e._id.$in:null;if(e.$and&&_.isArray(e.$and))for(var t=0;t<e.$and.length;++t){var n=LocalCollection._idsMatchedBySelector(e.$and[t]);if(n)return n}return null},EJSON.addType("oid",function(e){return new LocalCollection._ObjectID(e)}),n("lib/oid",function(){});var O=function(){function e(){var e=4022871197,t=function(t){t=t.toString();for(var n=0;n<t.length;n++){e+=t.charCodeAt(n);var r=.02519603282416938*e;e=r>>>0,r-=e,r*=e,e=r>>>0,r-=e,e+=4294967296*r}return 2.3283064365386963e-10*(e>>>0)};return t.version="Mash 0.9",t}return function(t){var n=0,r=0,o=0,i=1;0==t.length&&(t=[+new Date]);var l=e();n=l(" "),r=l(" "),o=l(" ");for(var c=0;c<t.length;c++)n-=l(t[c]),0>n&&(n+=1),r-=l(t[c]),0>r&&(r+=1),o-=l(t[c]),0>o&&(o+=1);l=null;var a=function(){var e=2091639*n+2.3283064365386963e-10*i;return n=r,r=o,o=e-(i=0|e)};return a.uint32=function(){return 4294967296*a()},a.fract53=function(){return a()+1.1102230246251565e-16*(0|2097152*a())},a.version="Alea 0.9",a.args=t,a}(Array.prototype.slice.call(arguments))},w="23456789ABCDEFGHJKLMNPQRSTWXYZabcdefghijkmnopqrstuvwxyz",E=function(){var e=O.apply(null,arguments),t={},n=function(e){return _.bind(e,t)};return _.extend(t,{_Alea:O,create:E,fraction:e,choice:n(function(e){var t=Math.floor(this.fraction()*e.length);return"string"==typeof e?e.substr(t,1):e[t]}),id:n(function(){for(var e=[],t=0;17>t;t++)e[t]=this.choice(w);return e.join("")}),hexString:n(function(e){for(var t=[],n=0;e>n;++n)t.push(this.choice("0123456789abcdef"));return t.join("")})})},L="undefined"!=typeof window&&window.innerHeight||"undefined"!=typeof document&&document.documentElement&&document.documentElement.clientHeight||"undefined"!=typeof document&&document.body&&document.body.clientHeight||1,S="undefined"!=typeof window&&window.innerWidth||"undefined"!=typeof document&&document.documentElement&&document.documentElement.clientWidth||"undefined"!=typeof document&&document.body&&document.body.clientWidth||1,k="undefined"!=typeof navigator&&navigator.userAgent||"",I="undefined"!=typeof process&&process.pid||1;Random=E([new Date,L,S,k,I,Math.random()]),n("lib/random",function(){});var N=function(e){return _.isArray(e)&&!EJSON.isBinary(e)},$=function(e,t){return N(e)?_.any(e,t):t(e)},J=function(e,t){return t(e)?!0:N(e)&&_.any(e,t)},j=function(e){var t=void 0;for(var n in e){var r="$"===n.substr(0,1);if(void 0===t)t=r;else if(t!==r)throw new Error("Inconsistent selector: "+e)}return!!t},D=function(e){if(null==e)return function(e){return $(e,function(e){return null==e})};if(!_.isObject(e))return function(t){return $(t,function(t){return t===e})};if(e instanceof RegExp)return function(t){return void 0===t?!1:$(t,function(t){return e.test(t)})};if(N(e))return function(t){return N(t)?J(t,function(t){return LocalCollection._f._equal(e,t)}):!1};if(j(e)){var t=[];return _.each(e,function(n,r){if(!_.has(A,r))throw new Error("Unrecognized operator: "+r);t.push(A[r](n,e.$options))}),function(e){return _.all(t,function(t){return t(e)})}}return function(t){return $(t,function(t){return LocalCollection._f._equal(e,t)})}},x={$and:function(e){if(!N(e)||_.isEmpty(e))throw Error("$and/$or/$nor must be nonempty array");var t=_.map(e,B);return function(e){return _.all(t,function(t){return t(e)})}},$or:function(e){if(!N(e)||_.isEmpty(e))throw Error("$and/$or/$nor must be nonempty array");var t=_.map(e,B);return function(e){return _.any(t,function(t){return t(e)})}},$nor:function(e){if(!N(e)||_.isEmpty(e))throw Error("$and/$or/$nor must be nonempty array");var t=_.map(e,B);return function(e){return _.all(t,function(t){return!t(e)})}},$where:function(e){return e instanceof Function||(e=Function("return "+e)),function(t){return e.call(t)}}},A={$in:function(e){if(!N(e))throw new Error("Argument to $in must be array");return function(t){return J(t,function(t){return _.any(e,function(e){return LocalCollection._f._equal(e,t)})})}},$all:function(e){if(!N(e))throw new Error("Argument to $all must be array");return function(t){return N(t)?_.all(e,function(e){return _.any(t,function(t){return LocalCollection._f._equal(e,t)})}):!1}},$lt:function(e){return function(t){return $(t,function(t){return LocalCollection._f._cmp(t,e)<0})}},$lte:function(e){return function(t){return $(t,function(t){return LocalCollection._f._cmp(t,e)<=0})}},$gt:function(e){return function(t){return $(t,function(t){return LocalCollection._f._cmp(t,e)>0})}},$gte:function(e){return function(t){return $(t,function(t){return LocalCollection._f._cmp(t,e)>=0})}},$ne:function(e){return function(t){return!J(t,function(t){return LocalCollection._f._equal(t,e)})}},$nin:function(e){if(!N(e))throw new Error("Argument to $nin must be array");var t=A.$in(e);return function(e){return void 0===e?!0:!t(e)}},$exists:function(e){return function(t){return e===(void 0!==t)}},$mod:function(e){var t=e[0],n=e[1];return function(e){return $(e,function(e){return e%t===n})}},$size:function(e){return function(t){return N(t)&&e===t.length}},$type:function(e){return function(t){return void 0===t?!1:$(t,function(t){return LocalCollection._f._type(t)===e})}},$regex:function(e,t){if(void 0!==t){if(/[^gim]/.test(t))throw new Error("Only the i, m, and g regexp options are supported");var n=e instanceof RegExp?e.source:e;e=new RegExp(n,t)}else e instanceof RegExp||(e=new RegExp(e));return function(t){return void 0===t?!1:$(t,function(t){return e.test(t)})}},$options:function(){return function(){return!0}},$elemMatch:function(e){var t=B(e);return function(e){return N(e)?_.any(e,function(e){return t(e)}):!1}},$not:function(e){var t=D(e);return function(e){return!t(e)}}};LocalCollection._f={_type:function(e){return"number"==typeof e?1:"string"==typeof e?2:"boolean"==typeof e?8:N(e)?4:null===e?10:e instanceof RegExp?11:"function"==typeof e?13:e instanceof Date?9:EJSON.isBinary(e)?5:e instanceof Meteor.Collection.ObjectID?7:3},_equal:function(e,t){return EJSON.equals(e,t,{keyOrderSensitive:!0})},_typeorder:function(e){return[-1,1,2,3,4,5,-1,6,7,8,0,9,-1,100,2,100,1,8,1][e]},_cmp:function(e,t){if(void 0===e)return void 0===t?0:-1;if(void 0===t)return 1;var n=LocalCollection._f._type(e),r=LocalCollection._f._type(t),o=LocalCollection._f._typeorder(n),i=LocalCollection._f._typeorder(r);if(o!==i)return i>o?-1:1;if(n!==r)throw Error("Missing type coercion logic in _cmp");if(7===n&&(n=r=2,e=e.toHexString(),t=t.toHexString()),9===n&&(n=r=1,e=e.getTime(),t=t.getTime()),1===n)return e-t;if(2===r)return t>e?-1:e===t?0:1;if(3===n){var l=function(e){var t=[];for(var n in e)t.push(n),t.push(e[n]);return t};return LocalCollection._f._cmp(l(e),l(t))}if(4===n)for(var c=0;;c++){if(c===e.length)return c===t.length?0:-1;if(c===t.length)return 1;var a=LocalCollection._f._cmp(e[c],t[c]);if(0!==a)return a}if(5===n){if(e.length!==t.length)return e.length-t.length;for(c=0;c<e.length;c++){if(e[c]<t[c])return-1;if(e[c]>t[c])return 1}return 0}if(8===n)return e?t?0:1:t?-1:0;if(10===n)return 0;if(11===n)throw Error("Sorting not supported on regular expression");if(13===n)throw Error("Sorting not supported on Javascript code");throw Error("Unknown type to sort")}},LocalCollection._matches=function(e,t){return LocalCollection._compileSelector(e)(t)},LocalCollection._makeLookupFunction=function(e){var t,n,r,o=e.indexOf(".");if(-1===o)t=e;else{t=e.substr(0,o);var i=e.substr(o+1);n=LocalCollection._makeLookupFunction(i),r=/^\d+(\.|$)/.test(i)}return function(e){if(null==e)return[void 0];var o=e[t];return n?N(o)&&0===o.length?[void 0]:((!N(o)||r)&&(o=[o]),Array.prototype.concat.apply([],_.map(o,n))):[o]}};var B=function(e){var t=[];return _.each(e,function(e,n){if("$"===n.substr(0,1)){if(!_.has(x,n))throw new Error("Unrecognized logical operator: "+n);t.push(x[n](e))}else{var r=LocalCollection._makeLookupFunction(n),o=D(e);t.push(function(e){var t=r(e);return _.any(t,o)})}}),function(e){return _.all(t,function(t){return t(e)})}};LocalCollection._compileSelector=function(e){if(e instanceof Function)return function(t){return e.call(t)};if(LocalCollection._selectorIsId(e))return function(t){return EJSON.equals(t._id,e)};if(!e||"_id"in e&&!e._id)return function(){return!1};if("boolean"==typeof e||N(e)||EJSON.isBinary(e))throw new Error("Invalid selector: "+e);return B(e)},LocalCollection._compileSort=function(e){var t=[];if(e instanceof Array)for(var n=0;n<e.length;n++)"string"==typeof e[n]?t.push({lookup:LocalCollection._makeLookupFunction(e[n]),ascending:!0}):t.push({lookup:LocalCollection._makeLookupFunction(e[n][0]),ascending:"desc"!==e[n][1]});else{if("object"!=typeof e)throw Error("Bad sort specification: ",JSON.stringify(e));for(var r in e)t.push({lookup:LocalCollection._makeLookupFunction(r),ascending:e[r]>=0})}if(0===t.length)return function(){return 0};var o=function(e,t){var n,r=!0;return _.each(e,function(e){N(e)||(e=[e]),N(e)&&0===e.length&&(e=[void 0]),_.each(e,function(e){if(r)n=e,r=!1;else{var o=LocalCollection._f._cmp(n,e);(t&&o>0||!t&&0>o)&&(n=e)}})}),n};return function(e,n){for(var r=0;r<t.length;++r){var i=t[r],l=o(i.lookup(e),i.ascending),c=o(i.lookup(n),i.ascending),a=LocalCollection._f._cmp(l,c);if(0!==a)return i.ascending?a:-a}return 0}},n("lib/selector",function(){}),Meteor={},Meteor._noYieldsAllowed=function(e){return e()},Meteor._SynchronousQueue=function(){var e=this;e._tasks=[],e._running=!1},_.extend(Meteor._SynchronousQueue.prototype,{runTask:function(e){var t=this;if(!t.safeToRunTask())throw new Error("Could not synchronously run a task from a running task");t._tasks.push(e);var n=t._tasks;t._tasks=[],t._running=!0;try{for(;!_.isEmpty(n);){var r=n.shift();try{r()}catch(o){if(_.isEmpty(n))throw o;console.log("Exception in queued task: "+o.stack)}}}finally{t._running=!1}},queueTask:function(e){var t=this,n=_.isEmpty(t._tasks);t._tasks.push(e),n&&setTimeout(_.bind(t.flush,t),0)},flush:function(){var e=this;e.runTask(function(){})},drain:function(){var e=this;if(e.safeToRunTask())for(;!_.isEmpty(e._tasks);)e.flush()},safeToRunTask:function(){var e=this;return!e._running}}),n("lib/synch-queue",function(){}),LocalCollection._diffQueryChanges=function(e,t,n,r){e?LocalCollection._diffQueryOrderedChanges(t,n,r):LocalCollection._diffQueryUnorderedChanges(t,n,r)},LocalCollection._diffQueryUnorderedChanges=function(e,t,n){if(n.moved)throw new Error("_diffQueryUnordered called with a moved observer!");_.each(t,function(t){if(_.has(e,t._id)){var r=e[t._id];n.changed&&!EJSON.equals(r,t)&&n.changed(t._id,LocalCollection._makeChangedFields(t,r))}else{var o=EJSON.clone(t);delete o._id,n.added&&n.added(t._id,o)}}),n.removed&&_.each(e,function(e){_.has(t,e._id)||n.removed(e._id)})},LocalCollection._diffQueryOrderedChanges=function(e,t,n){var r={};_.each(t,function(e){r[e._id]&&Meteor._debug("Duplicate _id in new_results"),r[e._id]=!0});var o={};_.each(e,function(e,t){e._id in o&&Meteor._debug("Duplicate _id in old_results"),o[e._id]=t});for(var i=[],l=0,c=t.length,a=new Array(c),u=new Array(c),s=function(e){return o[t[e]._id]},f=0;c>f;f++)if(void 0!==o[t[f]._id]){for(var d=l;d>0&&!(s(a[d-1])<s(f));)d--;u[f]=0===d?-1:a[d-1],a[d]=f,d+1>l&&(l=d+1)}for(var h=0===l?-1:a[l-1];h>=0;)i.push(h),h=u[h];i.reverse(),i.push(t.length),_.each(e,function(e){r[e._id]||n.removed&&n.removed(e._id)});var p=0;_.each(i,function(r){for(var i,l,c,a=t[r]?t[r]._id:null,u=p;r>u;u++)l=t[u],_.has(o,l._id)?(i=e[o[l._id]],c=LocalCollection._makeChangedFields(l,i),_.isEmpty(c)||n.changed&&n.changed(l._id,c),n.movedBefore&&n.movedBefore(l._id,a)):(c=EJSON.clone(l),delete c._id,n.addedBefore&&n.addedBefore(l._id,c,a),n.added&&n.added(l._id,c));a&&(l=t[r],i=e[o[l._id]],c=LocalCollection._makeChangedFields(l,i),_.isEmpty(c)||n.changed&&n.changed(l._id,c)),p=r+1})},LocalCollection._diffObjects=function(e,t,n){_.each(e,function(e,r){_.has(t,r)?n.both&&n.both(r,e,t[r]):n.leftOnly&&n.leftOnly(r,e)}),n.rightOnly&&_.each(t,function(t,r){_.has(e,r)||n.rightOnly(r,t)})},n("lib/diff",function(){}),n("backbone-mongo",[],function(){var e=[],t=e.push,n=e.slice,r=e.splice,o=Backbone.Collection.extend({model:Backbone.Model,initialize:function(){},toJSON:function(e){return this.map(function(t){return t.toJSON(e)})},sync:function(){return Backbone.sync.apply(this,arguments)},add:function(e,t){return this.set(e,_.defaults(t||{},{add:!0,merge:!1,remove:!1}))},remove:function(e,t){var n;n=_.isArray(e)?_.any(e,function(e){return e===this._prepareModel(e)},this):e===this._prepareModel(e),e=n?_.isArray(e)?e.slice():[e]:this.find(e).fetch(),t||(t={});var r,o,i,l;for(r=0,o=e.length;o>r;r++)if(l=this.get(e[r])){if(_.isEmpty(e)||!arguments.length)return this._reset(),void 0;delete this._byId[l.id],delete this._byId[l.cid],i=this.indexOf(l),this.models.splice(i,1),this._store.remove({cid:l.cid}),this.length--,t.silent||(t.index=i,l.trigger("remove",l,this,t)),this._removeReference(l)}return this},set:function(e,n){n=_.defaults(n||{}),n.parse&&(e=this.parse(e,n)),_.isArray(e)||(e=e?[e]:[]);var o,i,l,c,a,u=n.at,s=this.comparator&&null==u&&n.sort!==!1,f=_.isString(this.comparator)?this.comparator:null,d=[],h=[],p={};for(o=0,i=e.length;i>o;o++)(l=this._prepareModel(e[o],n))&&((c=this.get(l))?(n.remove&&(p[c.cid]=!0),n.merge&&(c.set(l.attributes,n),s&&!a&&c.hasChanged(f)&&(a=!0))):n.add&&(d.push(l),l.on("all",this._onModelEvent,this),this._byId[l.cid]=l,null!=l.id&&(this._byId[l.id]=l)));if(n.remove){for(o=0,i=this.length;i>o;++o)p[(l=this.models[o]).cid]||h.push(l);h.length&&this.remove(h,n)}if(d.length)if(s&&(a=!0),this.length+=d.length,null!=u){this._store.remove({});var v=_.head(this.models,u).concat(d).concat(_.tail(this.models,u));this._normalizedInsert(v),r.apply(this.models,[u,0].concat(d))}else this._normalizedInsert(d),t.apply(this.models,d);if(a&&this.sort({silent:!0}),n.silent)return this;for(o=0,i=d.length;i>o;o++)(l=d[o]).trigger("add",l,this,n);return a&&this.trigger("sort",this,n),this},reset:function(e,t){t||(t={});for(var n=0,r=this.models.length;r>n;n++)this._removeReference(this.models[n]);return t.previousModels=this.models,this._reset(),this.add(e,_.extend({silent:!0},t)),t.silent||this.trigger("reset",this,t),this},push:function(e,t){return e=this._prepareModel(e,t),this.add(e,_.extend({at:this.length},t)),e},pop:function(e){var t=this.at(this.length-1);return this.remove(t,e),t},unshift:function(e,t){return e=this._prepareModel(e,t),this.add(e,_.extend({at:0},t)),e},shift:function(e){var t=this.at(0);return this.remove(t,e),t},slice:function(e,t){return this.models.slice(e,t)},get:function(e){return null==e?void 0:this._byId[null!=e.id?e.id:e.cid||e]},at:function(e){return this.models[e]},where:function(e,t){if(_.isEmpty(e))return t?void 0:[];var n=function(t){for(var n in e)if(e[n]!==t.get(n))return!1;return!0};return t?_.find(this.models,n):this.filter(n)},findWhere:function(e){return this.where(e,!0)},sort:function(e){if(!this.comparator)throw new Error("Cannot sort a set without a comparator");return e||(e={}),_.isString(this.comparator)||1===this.comparator.length?this.models=this.sortBy(this.comparator,this):this.models.sort(_.bind(this.comparator,this)),this._store.remove({}),this._normalizedInsert(this.models),e.silent||this.trigger("sort",this,e),this},sortedIndex:function(e,t,n){t||(t=this.comparator);var r=_.isFunction(t)?t:function(e){return e.get(t)};return _.sortedIndex(this.models,e,r,n)},pluck:function(e){return _.invoke(this.models,"get",e)},fetch:function(e){e=e?_.clone(e):{},void 0===e.parse&&(e.parse=!0);var t=e.success,n=this;return e.success=function(r){var o=e.reset?"reset":"set";n[o](r,e),t&&t(n,r,e),n.trigger("sync",n,r,e)},this.sync("read",this,e)},create:function(e,t){if(t=t?_.clone(t):{},!(e=this._prepareModel(e,t)))return!1;t.wait||this.add(e,t);var n=this,r=t.success;return t.success=function(o){t.wait&&n.add(e,t),r&&r(e,o,t)},e.save(null,t),e},parse:function(e){return e},clone:function(){return new this.constructor(this.models)},_reset:function(){this.length=0,this.models=[],this._store=new LocalCollection,this._byId={}},_prepareModel:function(e,t){if(e instanceof Backbone.Model)return e.collection||(e.collection=this),e;t||(t={}),t.collection=this;var n=new this.model(e,t);return n._validate(e,t)?n:(this.trigger("invalid",this,e,t),!1)},_removeReference:function(e){this===e.collection&&delete e.collection,e.off("all",this._onModelEvent,this)},_onModelEvent:function(e,t,n,r){if("add"!==e&&"remove"!==e||n===this){if("destroy"===e&&this.remove(t,r),r&&!r.fromUpdate&&t&&/change\:/.test(e)){var o=/change\:(.*)/.exec(e)[1],i=n,l={};l[o]=i,this.update({cid:t.cid},{$set:l},this._byId)}t&&e==="change:"+t.idAttribute&&(delete this._byId[t.previous(t.idAttribute)],null!=t.id&&(this._byId[t.id]=t)),this.trigger.apply(this,arguments)}},insert:function(e,t){return this.add(e,t)},find:function(e,t){if(_.isFunction(e))return _.find(this.models,e,t);var n=this;return t=_.extend({},t,{_byId:this._byId,transform:function(e,t){var r;if(t)if("changedOld"===t){var o=_.omit(e,["cid","_id"]);r=n._prepareModel(o)}else"changedNew"===t&&(r=n._byId[e.cid]);else r=e!==n._prepareModel(e)?n._byId[e.cid]:e;return r}}),this._store.find(e||{},t)},findOne:function(e,t){var n=_.extend({},t,{_byId:this._byId});return this._store.findOne(e||{},n)},update:function(e,t,n){var r=_.extend({},n,{_byId:this._byId,multi:n&&n.multi?n.multi:!1});this._store.update(e,t,r)},_normalizedInsert:function(e){_.each(e,function(e){this._store.insert(_.extend(e.toJSON(),{cid:e.cid}))},this)}}),i=["forEach","each","map","collect","reduce","foldl","inject","reduceRight","foldr","find","detect","filter","select","reject","every","all","some","any","include","contains","invoke","max","min","toArray","size","first","head","take","initial","rest","tail","drop","last","without","indexOf","shuffle","lastIndexOf","isEmpty","chain"];_.each(i,function(e){Backbone.Collection.prototype[e]=function(){var t=n.call(arguments);return t.unshift(this.models),_[e].apply(_,t)}});var l=["groupBy","countBy","sortBy"];return _.each(l,function(e){Backbone.Collection.prototype[e]=function(t,n){var r=_.isFunction(t)?t:function(e){return e.get(t)};return _[e](this.models,r,n)}}),o}),window.Backbone.Mongo=t("backbone-mongo")});