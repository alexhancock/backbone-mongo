!function(e,n){"function"==typeof define&&define.amd?define(n):e.libGlobalName=n()}(this,function(){var e,n,t;!function(o){function r(e,n){return C.call(e,n)}function i(e,n){var t,o,r,i,l,c,a,u,s,f,d=n&&n.split("/"),h=y.map,_=h&&h["*"]||{};if(e&&"."===e.charAt(0))if(n){for(d=d.slice(0,d.length-1),e=d.concat(e.split("/")),u=0;u<e.length;u+=1)if(f=e[u],"."===f)e.splice(u,1),u-=1;else if(".."===f){if(1===u&&(".."===e[2]||".."===e[0]))break;u>0&&(e.splice(u-1,2),u-=2)}e=e.join("/")}else 0===e.indexOf("./")&&(e=e.substring(2));if((d||_)&&h){for(t=e.split("/"),u=t.length;u>0;u-=1){if(o=t.slice(0,u).join("/"),d)for(s=d.length;s>0;s-=1)if(r=h[d.slice(0,s).join("/")],r&&(r=r[o])){i=r,l=u;break}if(i)break;!c&&_&&_[o]&&(c=_[o],a=u)}!i&&c&&(i=c,l=a),i&&(t.splice(0,l,i),e=t.join("/"))}return e}function l(e,n){return function(){return h.apply(o,b.call(arguments,0).concat([e,n]))}}function c(e){return function(n){return i(n,e)}}function a(e){return function(n){v[e]=n}}function u(e){if(r(m,e)){var n=m[e];delete m[e],g[e]=!0,d.apply(o,n)}if(!r(v,e)&&!r(g,e))throw new Error("No "+e);return v[e]}function s(e){var n,t=e?e.indexOf("!"):-1;return t>-1&&(n=e.substring(0,t),e=e.substring(t+1,e.length)),[n,e]}function f(e){return function(){return y&&y.config&&y.config[e]||{}}}var d,h,_,p,v={},m={},y={},g={},C=Object.prototype.hasOwnProperty,b=[].slice;_=function(e,n){var t,o=s(e),r=o[0];return e=o[1],r&&(r=i(r,n),t=u(r)),r?e=t&&t.normalize?t.normalize(e,c(n)):i(e,n):(e=i(e,n),o=s(e),r=o[0],e=o[1],r&&(t=u(r))),{f:r?r+"!"+e:e,n:e,pr:r,p:t}},p={require:function(e){return l(e)},exports:function(e){var n=v[e];return"undefined"!=typeof n?n:v[e]={}},module:function(e){return{id:e,uri:"",exports:v[e],config:f(e)}}},d=function(e,n,t,i){var c,s,f,d,h,y,C=[];if(i=i||e,"function"==typeof t){for(n=!n.length&&t.length?["require","exports","module"]:n,h=0;h<n.length;h+=1)if(d=_(n[h],i),s=d.f,"require"===s)C[h]=p.require(e);else if("exports"===s)C[h]=p.exports(e),y=!0;else if("module"===s)c=C[h]=p.module(e);else if(r(v,s)||r(m,s)||r(g,s))C[h]=u(s);else{if(!d.p)throw new Error(e+" missing "+s);d.p.load(d.n,l(i,!0),a(s),{}),C[h]=v[s]}f=t.apply(v[e],C),e&&(c&&c.exports!==o&&c.exports!==v[e]?v[e]=c.exports:f===o&&y||(v[e]=f))}else e&&(v[e]=t)},e=n=h=function(e,n,t,r,i){return"string"==typeof e?p[e]?p[e](n):u(_(e,n).f):(e.splice||(y=e,n.splice?(e=n,n=t,t=null):e=o),n=n||function(){},"function"==typeof t&&(t=r,r=i),r?d(o,e,n,t):setTimeout(function(){d(o,e,n,t)},4),h)},h.config=function(e){return y=e,y.deps&&h(y.deps,y.callback),h},t=function(e,n,t){n.splice||(t=n,n=[]),r(v,e)||r(m,e)||(m[e]=[e,n,t])},t.amd={jQuery:!0}}(),t("components/almond",function(){}),LocalCollection=function(){this.docs={},this._observeQueue=new Meteor._SynchronousQueue,this.next_qid=1,this.queries={},this._savedOriginals=null,this.paused=!1},LocalCollection._applyChanges=function(e,n){_.each(n,function(n,t){void 0===n?delete e[t]:e[t]=n})},LocalCollection.MinimongoError=function(e){var n=this;n.name="MinimongoError",n.details=e},LocalCollection.MinimongoError.prototype=new Error,LocalCollection.prototype.find=function(e,n,t){return 0===arguments.length&&(e={}),t&&!this._byId&&(this._byId=t),new LocalCollection.Cursor(this,e,n,t)},LocalCollection.Cursor=function(e,n,t,o){var r=this;this._byId=o||[],t||(t={}),this.collection=e,LocalCollection._selectorIsId(n)?(r.selector_id=LocalCollection._idStringify(n),r.selector_f=LocalCollection._compileSelector(n),r.sort_f=void 0):(r.selector_id=void 0,r.selector_f=LocalCollection._compileSelector(n),r.sort_f=t.sort?LocalCollection._compileSort(t.sort):null),r.skip=t.skip,r.limit=t.limit,r._transform=t.transform&&"undefined"!=typeof Deps?Deps._makeNonreactive(t.transform):t.transform,r.db_objects=null,r.cursor_pos=0,"undefined"!=typeof Deps&&(r.reactive=void 0===t.reactive?!0:t.reactive)},LocalCollection.Cursor.prototype.rewind=function(){var e=this;e.db_objects=null,e.cursor_pos=0},LocalCollection.prototype.findOne=function(e,n,t){return 0===arguments.length&&(e={}),t&&!this._byId&&(this._byId=t),n=n||{},n.limit=1,this.find(e,n,this._byId).fetch()[0]},LocalCollection.Cursor.prototype.forEach=function(e){var n=this;for(null===n.db_objects&&(n.db_objects=n._getRawObjects(!0)),n.reactive&&n._depend({addedBefore:!0,removed:!0,changed:!0,movedBefore:!0});n.cursor_pos<n.db_objects.length;){var t=EJSON.clone(n.db_objects[n.cursor_pos++]);t=n._byId[t.cid],n._transform&&(t=n._transform(t)),e(t)}},LocalCollection.Cursor.prototype.getTransform=function(){var e=this;return e._transform},LocalCollection.Cursor.prototype.map=function(e){var n=this,t=[];return n.forEach(function(o){o=n._byId[o.cid],t.push(e(o))}),t},LocalCollection.Cursor.prototype.fetch=function(){var e=this,n=[];return e.forEach(function(t){t&&(t=e._byId[t.cid]),n.push(t)}),n},LocalCollection.Cursor.prototype.count=function(){var e=this;return e.reactive&&e._depend({added:!0,removed:!0}),null===e.db_objects&&(e.db_objects=e._getRawObjects(!0)),e.db_objects.length},LocalCollection._isOrderedChanges=function(e){if(e.added&&e.addedBefore)throw new Error("Please specify only one of added() and addedBefore()");return"function"==typeof e.addedBefore||"function"==typeof e.movedBefore},LocalCollection.LiveResultsSet=function(){},_.extend(LocalCollection.Cursor.prototype,{observe:function(e){var n=this;return LocalCollection._observeFromObserveChanges(n,e)},observeChanges:function(e){var n=this,t=LocalCollection._isOrderedChanges(e);if(!t&&(n.skip||n.limit))throw new Error("must use ordered observe with skip or limit");var o,r={selector_f:n.selector_f,sort_f:t&&n.sort_f,results_snapshot:null,ordered:t,cursor:this,observeChanges:e.observeChanges};n.reactive&&(o=n.collection.next_qid++,n.collection.queries[o]=r),r.results=n._getRawObjects(t),n.collection.paused&&(r.results_snapshot=t?[]:{});var i=function(e){return e?function(){var t=this,o=arguments;n.collection.paused||n.collection._observeQueue.queueTask(function(){e.apply(t,o)})}:function(){}};r.added=i(e.added),r.changed=i(e.changed),r.removed=i(e.removed),t&&(r.moved=i(e.moved),r.addedBefore=i(e.addedBefore),r.movedBefore=i(e.movedBefore)),e._suppress_initial||n.collection.paused||_.each(r.results,function(e){var n=EJSON.clone(e);delete n._id,t&&r.addedBefore(e._id,n,null),r.added(e._id,n)});var l=new LocalCollection.LiveResultsSet;return _.extend(l,{collection:n.collection,stop:function(){n.reactive&&delete n.collection.queries[o]}}),n.reactive&&Deps.active&&Deps.onInvalidate(function(){l.stop()}),n.collection._observeQueue.drain(),l}}),LocalCollection.Cursor.prototype._getRawObjects=function(e){var n=this,t=e?[]:{};if(n.selector_id){if(n.skip)return t;if(_.has(n.collection.docs,n.selector_id)){var o=n.collection.docs[n.selector_id];e?t.push(o):t[n.selector_id]=o}return t}for(var r in n.collection.docs){var i=n.collection.docs[r];if(n.selector_f(i)&&(e?t.push(i):t[r]=i),n.limit&&!n.skip&&!n.sort_f&&t.length===n.limit)return t}if(!e)return t;n.sort_f&&t.sort(n.sort_f);var l=n.skip||0,c=n.limit?n.limit+l:t.length;return t.slice(l,c)},LocalCollection.Cursor.prototype._depend=function(e){var n=this;if(Deps.active){var t=new Deps.Dependency;t.depend();var o=_.bind(t.changed,t),r={_suppress_initial:!0};_.each(["added","changed","removed","addedBefore","movedBefore"],function(n){e[n]&&(r[n]=o)}),n.observeChanges(r)}},LocalCollection.prototype.insert=function(e){var n=this;if(_.isArray(e))return _.each(e,_.bind(n.insert,n));e=EJSON.clone(e),_.has(e,"_id")||(e._id=LocalCollection._useOID?new LocalCollection._ObjectID:Random.id());var t=LocalCollection._idStringify(e._id);if(_.has(n.docs,e._id))throw new LocalCollection.MinimongoError("Duplicate _id '"+e._id+"'");n._saveOriginal(t,void 0),n.docs[t]=e;var o=[];for(var r in n.queries){var i=n.queries[r];i.selector_f(e)&&(i.cursor.skip||i.cursor.limit?o.push(r):LocalCollection._insertInResults(i,e))}return _.each(o,function(e){n.queries[e]&&LocalCollection._recomputeResults(n.queries[e])}),n._observeQueue.drain(),e._id},LocalCollection.prototype.remove=function(e){var n=this,t=[],o=[],r=LocalCollection._compileSelector(e),i=LocalCollection._idsMatchedBySelector(e);if(i)_.each(i,function(e){var o=LocalCollection._idStringify(e);_.has(n.docs,o)&&r(n.docs[o])&&t.push(o)});else for(var l in n.docs){var c=n.docs[l];r(c)&&t.push(l)}for(var a=[],u=0;u<t.length;u++){var s=t[u],f=n.docs[s];_.each(n.queries,function(e,n){e.selector_f(f)&&(e.cursor.skip||e.cursor.limit?o.push(n):a.push({qid:n,doc:f}))}),n._saveOriginal(s,f),delete n.docs[s]}_.each(a,function(e){var t=n.queries[e.qid];t&&LocalCollection._removeFromResults(t,e.doc)}),_.each(o,function(e){var t=n.queries[e];t&&LocalCollection._recomputeResults(t)}),n._observeQueue.drain()},LocalCollection.prototype.update=function(e,n,t,o){var r=this;if(t||(t={}),!this._byId&&o&&(this._byId=o||[]),t.upsert)throw new Error("upsert not yet implemented");var i=LocalCollection._compileSelector(e),l={};_.each(r.queries,function(e,n){!e.cursor.skip&&!e.cursor.limit||e.paused||(l[n]=EJSON.clone(e.results))});var c={};for(var a in r.docs){var u=r.docs[a];if(i(u)&&(r._saveOriginal(a,u),r._modifyAndNotify(u,n,c),!t.multi))break}_.each(c,function(e,n){var t=r.queries[n];t&&LocalCollection._recomputeResults(t,l[n])}),r._observeQueue.drain()},LocalCollection.prototype._modifyAndNotify=function(e,n,t){var o=this,r={};for(var i in o.queries){var l=o.queries[i];r[i]=l.ordered?l.selector_f(e):_.has(l.results,LocalCollection._idStringify(e._id))}var c=EJSON.clone(e);LocalCollection._modify(e,n);var a=_.omit(e,["cid","_id"]),u=this._byId[e.cid];if(!u)throw new Error("Model mismatch during update");u.set(a,{fromUpdate:!0});for(i in o.queries){l=o.queries[i];var s=r[i],f=l.selector_f(e);l.cursor.skip||l.cursor.limit?(s||f)&&(t[i]=!0):s&&!f?LocalCollection._removeFromResults(l,e):!s&&f?LocalCollection._insertInResults(l,e):s&&f&&LocalCollection._updateInResults(l,e,c)}},LocalCollection._insertInResults=function(e,n){var t=EJSON.clone(n);if(delete t._id,e.ordered){if(e.sort_f){var o=LocalCollection._insertInSortedList(e.sort_f,e.results,n),r=e.results[o+1];r=r?r._id:null,e.addedBefore(n._id,t,r)}else e.addedBefore(n._id,t,null),e.results.push(n);e.added(n._id,t)}else e.added(n._id,t),e.results[LocalCollection._idStringify(n._id)]=n},LocalCollection._removeFromResults=function(e,n){if(e.ordered){var t=LocalCollection._findInOrderedResults(e,n);e.removed(n._id),e.results.splice(t,1)}else{var o=LocalCollection._idStringify(n._id);e.removed(n._id),delete e.results[o]}},LocalCollection._updateInResults=function(e,n,t){if(!EJSON.equals(n._id,t._id))throw new Error("Can't change a doc's _id while updating");var o=LocalCollection._makeChangedFields(n,t);if(!e.ordered)return _.isEmpty(o)||(e.changed(n._id,o),e.results[LocalCollection._idStringify(n._id)]=n),void 0;var r=LocalCollection._findInOrderedResults(e,n);if(_.isEmpty(o)||e.changed(n._id,o),e.sort_f){e.results.splice(r,1);var i=LocalCollection._insertInSortedList(e.sort_f,e.results,n);if(r!==i){var l=e.results[i+1];l=l?l._id:null,e.movedBefore&&e.movedBefore(n._id,l)}}},LocalCollection._recomputeResults=function(e,n){n||(n=e.results),e.results=e.cursor._getRawObjects(e.ordered),e.paused||LocalCollection._diffQueryChanges(e.ordered,n,e.results,e)},LocalCollection._findInOrderedResults=function(e,n){if(!e.ordered)throw new Error("Can't call _findInOrderedResults on unordered query");for(var t=0;t<e.results.length;t++)if(e.results[t]===n)return t;throw Error("object missing from query")},LocalCollection._binarySearch=function(e,n,t){for(var o=0,r=n.length;r>0;){var i=Math.floor(r/2);e(t,n[o+i])>=0?(o+=i+1,r-=i+1):r=i}return o},LocalCollection._insertInSortedList=function(e,n,t){if(0===n.length)return n.push(t),0;var o=LocalCollection._binarySearch(e,n,t);return n.splice(o,0,t),o},LocalCollection.prototype.saveOriginals=function(){var e=this;if(e._savedOriginals)throw new Error("Called saveOriginals twice without retrieveOriginals");e._savedOriginals={}},LocalCollection.prototype.retrieveOriginals=function(){var e=this;if(!e._savedOriginals)throw new Error("Called retrieveOriginals without saveOriginals");var n=e._savedOriginals;return e._savedOriginals=null,n},LocalCollection.prototype._saveOriginal=function(e,n){var t=this;t._savedOriginals&&(_.has(t._savedOriginals,e)||(t._savedOriginals[e]=EJSON.clone(n)))},LocalCollection.prototype.pauseObservers=function(){if(!this.paused){this.paused=!0;for(var e in this.queries){var n=this.queries[e];n.results_snapshot=EJSON.clone(n.results)}}},LocalCollection.prototype.resumeObservers=function(){var e=this;if(this.paused){this.paused=!1;for(var n in this.queries){var t=e.queries[n];LocalCollection._diffQueryChanges(t.ordered,t.results_snapshot,t.results,t),t.results_snapshot=null}e._observeQueue.drain()}},LocalCollection._idStringify=function(e){if(e instanceof LocalCollection._ObjectID)return e.valueOf();if("string"==typeof e)return""===e?e:"-"===e.substr(0,1)||"~"===e.substr(0,1)||LocalCollection._looksLikeObjectID(e)||"{"===e.substr(0,1)?"-"+e:e;if(void 0===e)return"-";if("object"==typeof e)throw new Error("Meteor does not currently support objects other than ObjectID as ids");return"~"+JSON.stringify(e)},LocalCollection._idParse=function(e){return""===e?e:"-"===e?void 0:"-"===e.substr(0,1)?e.substr(1):"~"===e.substr(0,1)?JSON.parse(e.substr(1)):LocalCollection._looksLikeObjectID(e)?new LocalCollection._ObjectID(e):e},"undefined"!=typeof Meteor&&(Meteor.idParse=LocalCollection._idParse,Meteor.idStringify=LocalCollection._idStringify),LocalCollection._makeChangedFields=function(e,n){var t={};return LocalCollection._diffObjects(n,e,{leftOnly:function(e){t[e]=void 0},rightOnly:function(e,n){t[e]=n},both:function(e,n,o){EJSON.equals(n,o)||(t[e]=o)}}),t},LocalCollection._observeFromObserveChanges=function(e,n){var t=e.getTransform();if(t||(t=function(e){return e}),n.addedAt&&n.added)throw new Error("Please specify only one of added() and addedAt()");if(n.changedAt&&n.changed)throw new Error("Please specify only one of changed() and changedAt()");if(n.removed&&n.removedAt)throw new Error("Please specify only one of removed() and removedAt()");return n.addedAt||n.movedTo||n.changedAt||n.removedAt?LocalCollection._observeOrderedFromObserveChanges(e,n,t):LocalCollection._observeUnorderedFromObserveChanges(e,n,t)},LocalCollection._observeUnorderedFromObserveChanges=function(e,n,t){var o={},r=!!n._suppress_initial,i=e.observeChanges({added:function(e,i){var l=LocalCollection._idStringify(e),c=EJSON.clone(i);c._id=e,o[l]=c,r||n.added&&n.added(t(c))},changed:function(e,i){var l=LocalCollection._idStringify(e),c=o[l],a=EJSON.clone(c);LocalCollection._applyChanges(c,i),r||n.changed&&n.changed(t(c),t(a))},removed:function(e){var i=LocalCollection._idStringify(e),l=o[i];delete o[i],r||n.removed&&n.removed(t(l))}});return r=!1,i},LocalCollection._observeOrderedFromObserveChanges=function(e,n,t){var o=new OrderedDict(LocalCollection._idStringify),r=!!n._suppress_initial,i=e.observeChanges({addedBefore:function(e,i,l){var c=EJSON.clone(i);if(c._id=e,o.putBefore(e,c,l?l:null),!r)if(n.addedAt){var a=o.indexOf(e);n.addedAt(t(EJSON.clone(c)),a,l)}else n.added&&n.added(t(EJSON.clone(c)))},changed:function(e,r){var i=o.get(e);if(!i)throw new Error("Unknown id for changed: "+e);var l=EJSON.clone(i);if(LocalCollection._applyChanges(i,r),n.changedAt){var c=o.indexOf(e);n.changedAt(t(EJSON.clone(i)),t(l),c)}else n.changed&&n.changed(t(EJSON.clone(i)),t(l))},movedBefore:function(e,r){var i,l=o.get(e);if(n.movedTo&&(i=o.indexOf(e)),o.moveBefore(e,r?r:null),n.movedTo){var c=o.indexOf(e);n.movedTo(t(EJSON.clone(l)),i,c)}else n.moved&&n.moved(t(EJSON.clone(l)))},removed:function(e){var r,i=o.get(e);n.removedAt&&(r=o.indexOf(e)),o.remove(e),n.removedAt&&n.removedAt(t(i),r),n.removed&&n.removed(t(i))}});return r=!1,i},t("minimongo",function(e){return function(){var n;return n||e.LocalCollection}}(this)),LocalCollection._modify=function(e,n){var t=!1;for(var o in n){t="$"===o.substr(0,1);break}var r;if(t){var r=EJSON.clone(e);for(var i in n){var l=LocalCollection._modifiers[i];if(!l)throw Error("Invalid modifier specified "+i);for(var c in n[i]){if(c.length&&"."===c[c.length-1])throw Error("Invalid mod field name, may not end in a period");var a=n[i][c],u=c.split("."),s=!!LocalCollection._noCreateModifiers[i],f="$rename"===i,d=LocalCollection._findModTarget(r,u,s,f),h=u.pop();l(d,h,a,c,r)}}}else{if(n._id&&!EJSON.equals(e._id,n._id))throw Error("Cannot change the _id of a document");for(var o in n){if("$"===o.substr(0,1))throw Error("When replacing document, field name may not start with '$'");if(/\./.test(o))throw Error("When replacing document, field name may not contain '.'")}r=n}_.each(_.keys(e),function(n){"_id"!==n&&delete e[n]});for(var o in r)e[o]=r[o]},LocalCollection._findModTarget=function(e,n,t,o){for(var r=0;r<n.length;r++){var i=r===n.length-1,l=n[r],c=/^[0-9]+$/.test(l);if(!(!t||"object"==typeof e&&l in e))return void 0;if(e instanceof Array){if(o)return null;if(!c)throw Error("can't append to array using string field name ["+l+"]");for(l=parseInt(l),i&&(n[r]=l);e.length<l;)e.push(null);if(!i)if(e.length===l)e.push({});else if("object"!=typeof e[l])throw Error("can't modify field '"+n[r+1]+"' of list value "+JSON.stringify(e[l]))}else i||l in e||(e[l]={});if(i)return e;e=e[l]}},LocalCollection._noCreateModifiers={$unset:!0,$pop:!0,$rename:!0,$pull:!0,$pullAll:!0},LocalCollection._modifiers={$inc:function(e,n,t){if("number"!=typeof t)throw Error("Modifier $inc allowed for numbers only");if(n in e){if("number"!=typeof e[n])throw Error("Cannot apply $inc modifier to non-number");e[n]+=t}else e[n]=t},$set:function(e,n,t){if("_id"===n&&!EJSON.equals(t,e._id))throw Error("Cannot change the _id of a document");e[n]=EJSON.clone(t)},$unset:function(e,n){void 0!==e&&(e instanceof Array?n in e&&(e[n]=null):delete e[n])},$push:function(e,n,t){var o=e[n];if(void 0===o)e[n]=[t];else{if(!(o instanceof Array))throw Error("Cannot apply $push modifier to non-array");o.push(EJSON.clone(t))}},$pushAll:function(e,n,t){if(!("object"==typeof t&&t instanceof Array))throw Error("Modifier $pushAll/pullAll allowed for arrays only");var o=e[n];if(void 0===o)e[n]=t;else{if(!(o instanceof Array))throw Error("Cannot apply $pushAll modifier to non-array");for(var r=0;r<t.length;r++)o.push(t[r])}},$addToSet:function(e,n,t){var o=e[n];if(void 0===o)e[n]=[t];else{if(!(o instanceof Array))throw Error("Cannot apply $addToSet modifier to non-array");var r=!1;if("object"==typeof t)for(var i in t){"$each"===i&&(r=!0);break}var l=r?t.$each:[t];_.each(l,function(e){for(var n=0;n<o.length;n++)if(LocalCollection._f._equal(e,o[n]))return;o.push(e)})}},$pop:function(e,n,t){if(void 0!==e){var o=e[n];if(void 0!==o){if(!(o instanceof Array))throw Error("Cannot apply $pop modifier to non-array");"number"==typeof t&&0>t?o.splice(0,1):o.pop()}}},$pull:function(e,n,t){if(void 0!==e){var o=e[n];if(void 0!==o){if(!(o instanceof Array))throw Error("Cannot apply $pull/pullAll modifier to non-array");var r=[];if("object"!=typeof t||t instanceof Array)for(var i=0;i<o.length;i++)LocalCollection._f._equal(o[i],t)||r.push(o[i]);else for(var l=LocalCollection._compileSelector(t),i=0;i<o.length;i++)l(o[i])||r.push(o[i]);e[n]=r}}},$pullAll:function(e,n,t){if(!("object"==typeof t&&t instanceof Array))throw Error("Modifier $pushAll/pullAll allowed for arrays only");if(void 0!==e){var o=e[n];if(void 0!==o){if(!(o instanceof Array))throw Error("Cannot apply $pull/pullAll modifier to non-array");for(var r=[],i=0;i<o.length;i++){for(var l=!1,c=0;c<t.length;c++)if(LocalCollection._f._equal(o[i],t[c])){l=!0;break}l||r.push(o[i])}e[n]=r}}},$rename:function(e,n,t,o,r){if(o===t)throw Error("$rename source must differ from target");if(null===e)throw Error("$rename source field invalid");if("string"!=typeof t)throw Error("$rename target must be a string");if(void 0!==e){var i=e[n];delete e[n];var l=t.split("."),c=LocalCollection._findModTarget(r,l,!1,!0);if(null===c)throw Error("$rename target field invalid");var a=l.pop();c[a]=i}},$bit:function(){throw Error("$bit is not supported")}},t("lib/minimongo-modify",function(){}),EJSON={};var o={};EJSON.addType=function(e,n){if(_.has(o,e))throw new Error("Type "+e+" already present");o[e]=n};var r=[{matchJSONValue:function(e){return _.has(e,"$date")&&1===_.size(e)},matchObject:function(e){return e instanceof Date},toJSONValue:function(e){return{$date:e.getTime()}},fromJSONValue:function(e){return new Date(e.$date)}},{matchJSONValue:function(e){return _.has(e,"$binary")&&1===_.size(e)},matchObject:function(e){return"undefined"!=typeof Uint8Array&&e instanceof Uint8Array||e&&_.has(e,"$Uint8ArrayPolyfill")},toJSONValue:function(e){return{$binary:EJSON._base64Encode(e)}},fromJSONValue:function(e){return EJSON._base64Decode(e.$binary)}},{matchJSONValue:function(e){return _.has(e,"$escape")&&1===_.size(e)},matchObject:function(e){return _.isEmpty(e)||_.size(e)>2?!1:_.any(r,function(n){return n.matchJSONValue(e)})},toJSONValue:function(e){var n={};return _.each(e,function(e,t){n[t]=EJSON.toJSONValue(e)}),{$escape:n}},fromJSONValue:function(e){var n={};return _.each(e.$escape,function(e,t){n[t]=EJSON.fromJSONValue(e)}),n}},{matchJSONValue:function(e){return _.has(e,"$type")&&_.has(e,"$value")&&2===_.size(e)},matchObject:function(e){return EJSON._isCustomType(e)},toJSONValue:function(e){return{$type:e.typeName(),$value:e.toJSONValue()}},fromJSONValue:function(e){var n=e.$type,t=o[n];return t(e.$value)}}];EJSON._isCustomType=function(e){return e&&"function"==typeof e.toJSONValue&&"function"==typeof e.typeName&&_.has(o,e.typeName())};var i=EJSON._adjustTypesToJSONValue=function(e){if(null===e)return null;var n=l(e);return void 0!==n?n:(_.each(e,function(n,t){if("object"==typeof n||void 0===n){var o=l(n);return o?(e[t]=o,void 0):(i(n),void 0)}}),e)},l=function(e){for(var n=0;n<r.length;n++){var t=r[n];if(t.matchObject(e))return t.toJSONValue(e)}return void 0};EJSON.toJSONValue=function(e){var n=l(e);return void 0!==n?n:("object"==typeof e&&(e=EJSON.clone(e),i(e)),e)};var c=EJSON._adjustTypesFromJSONValue=function(e){if(null===e)return null;var n=a(e);return n!==e?n:(_.each(e,function(n,t){if("object"==typeof n){var o=a(n);if(n!==o)return e[t]=o,void 0;c(n)}}),e)},a=function(e){if("object"==typeof e&&null!==e&&_.size(e)<=2&&_.all(e,function(e,n){return"string"==typeof n&&"$"===n.substr(0,1)}))for(var n=0;n<r.length;n++){var t=r[n];if(t.matchJSONValue(e))return t.fromJSONValue(e)}return e};EJSON.fromJSONValue=function(e){var n=a(e);return n===e&&"object"==typeof e?(e=EJSON.clone(e),c(e),e):n},EJSON.stringify=function(e){return JSON.stringify(EJSON.toJSONValue(e))},EJSON.parse=function(e){return EJSON.fromJSONValue(JSON.parse(e))},EJSON.isBinary=function(e){return!!("undefined"!=typeof Uint8Array&&e instanceof Uint8Array||e&&e.$Uint8ArrayPolyfill)},EJSON.equals=function(e,n,t){var o,r=!(!t||!t.keyOrderSensitive);if(e===n)return!0;if(!e||!n)return!1;if("object"!=typeof e||"object"!=typeof n)return!1;if(e instanceof Date&&n instanceof Date)return e.valueOf()===n.valueOf();if(EJSON.isBinary(e)&&EJSON.isBinary(n)){if(e.length!==n.length)return!1;for(o=0;o<e.length;o++)if(e[o]!==n[o])return!1;return!0}if("function"==typeof e.equals)return e.equals(n,t);if(e instanceof Array){if(!(n instanceof Array))return!1;if(e.length!==n.length)return!1;for(o=0;o<e.length;o++)if(!EJSON.equals(e[o],n[o],t))return!1;return!0}var i;if(r){var l=[];return _.each(n,function(e,n){l.push(n)}),o=0,i=_.all(e,function(e,r){return o>=l.length?!1:r!==l[o]?!1:EJSON.equals(e,n[l[o]],t)?(o++,!0):!1}),i&&o===l.length}return o=0,i=_.all(e,function(e,r){return _.has(n,r)?EJSON.equals(e,n[r],t)?(o++,!0):!1:!1}),i&&_.size(n)===o},EJSON.clone=function(e){var n;if("object"!=typeof e)return e;if(null===e)return null;if(e instanceof Date)return new Date(e.getTime());if(EJSON.isBinary(e)){n=EJSON.newBinary(e.length);for(var t=0;t<e.length;t++)n[t]=e[t];return n}if(_.isArray(e)||_.isArguments(e)){for(n=[],t=0;t<e.length;t++)n[t]=EJSON.clone(e[t]);return n}return"function"==typeof e.clone,n={},_.each(e,function(e,t){n[t]=EJSON.clone(e)}),n},t("lib/ejson",function(){}),LocalCollection._looksLikeObjectID=function(e){return 24===e.length&&e.match(/^[0-9a-f]*$/)},LocalCollection._ObjectID=function(e){var n=this;if(e){if(e=e.toLowerCase(),!LocalCollection._looksLikeObjectID(e))throw new Error("Invalid hexadecimal string for creating an ObjectID");n._str=e}else n._str=Random.hexString(24)},LocalCollection._ObjectID.prototype.toString=function(){var e=this;return'ObjectID("'+e._str+'")'},LocalCollection._ObjectID.prototype.equals=function(e){var n=this;return e instanceof LocalCollection._ObjectID&&n.valueOf()===e.valueOf()},LocalCollection._ObjectID.prototype.clone=function(){var e=this;return new LocalCollection._ObjectID(e._str)},LocalCollection._ObjectID.prototype.typeName=function(){return"oid"},LocalCollection._ObjectID.prototype.getTimestamp=function(){var e=this;return parseInt(e._str.substr(0,8),16)},LocalCollection._ObjectID.prototype.valueOf=LocalCollection._ObjectID.prototype.toJSONValue=LocalCollection._ObjectID.prototype.toHexString=function(){return this._str},LocalCollection._selectorIsId=function(e){return"string"==typeof e||"number"==typeof e||e instanceof LocalCollection._ObjectID},LocalCollection._selectorIsIdPerhapsAsObject=function(e){return LocalCollection._selectorIsId(e)||e&&"object"==typeof e&&e._id&&LocalCollection._selectorIsId(e._id)&&1===_.size(e)},LocalCollection._idsMatchedBySelector=function(e){if(LocalCollection._selectorIsId(e))return[e];if(!e)return null;if(_.has(e,"_id"))return LocalCollection._selectorIsId(e._id)?[e._id]:e._id&&e._id.$in&&_.isArray(e._id.$in)&&!_.isEmpty(e._id.$in)&&_.all(e._id.$in,LocalCollection._selectorIsId)?e._id.$in:null;if(e.$and&&_.isArray(e.$and))for(var n=0;n<e.$and.length;++n){var t=LocalCollection._idsMatchedBySelector(e.$and[n]);if(t)return t}return null},EJSON.addType("oid",function(e){return new LocalCollection._ObjectID(e)}),t("lib/oid",function(){});var u=function(){function e(){var e=4022871197,n=function(n){n=n.toString();for(var t=0;t<n.length;t++){e+=n.charCodeAt(t);var o=.02519603282416938*e;e=o>>>0,o-=e,o*=e,e=o>>>0,o-=e,e+=4294967296*o}return 2.3283064365386963e-10*(e>>>0)};return n.version="Mash 0.9",n}return function(n){var t=0,o=0,r=0,i=1;0==n.length&&(n=[+new Date]);var l=e();t=l(" "),o=l(" "),r=l(" ");for(var c=0;c<n.length;c++)t-=l(n[c]),0>t&&(t+=1),o-=l(n[c]),0>o&&(o+=1),r-=l(n[c]),0>r&&(r+=1);l=null;var a=function(){var e=2091639*t+2.3283064365386963e-10*i;return t=o,o=r,r=e-(i=0|e)};return a.uint32=function(){return 4294967296*a()},a.fract53=function(){return a()+1.1102230246251565e-16*(0|2097152*a())},a.version="Alea 0.9",a.args=n,a}(Array.prototype.slice.call(arguments))},s="23456789ABCDEFGHJKLMNPQRSTWXYZabcdefghijkmnopqrstuvwxyz",f=function(){var e=u.apply(null,arguments),n={},t=function(e){return _.bind(e,n)};return _.extend(n,{_Alea:u,create:f,fraction:e,choice:t(function(e){var n=Math.floor(this.fraction()*e.length);return"string"==typeof e?e.substr(n,1):e[n]}),id:t(function(){for(var e=[],n=0;17>n;n++)e[n]=this.choice(s);return e.join("")}),hexString:t(function(e){for(var n=[],t=0;e>t;++t)n.push(this.choice("0123456789abcdef"));return n.join("")})})},d="undefined"!=typeof window&&window.innerHeight||"undefined"!=typeof document&&document.documentElement&&document.documentElement.clientHeight||"undefined"!=typeof document&&document.body&&document.body.clientHeight||1,h="undefined"!=typeof window&&window.innerWidth||"undefined"!=typeof document&&document.documentElement&&document.documentElement.clientWidth||"undefined"!=typeof document&&document.body&&document.body.clientWidth||1,p="undefined"!=typeof navigator&&navigator.userAgent||"",v="undefined"!=typeof process&&process.pid||1;Random=f([new Date,d,h,p,v,Math.random()]),t("lib/random",function(){});var m=function(e){return _.isArray(e)&&!EJSON.isBinary(e)},y=function(e,n){return m(e)?_.any(e,n):n(e)},g=function(e,n){return n(e)?!0:m(e)&&_.any(e,n)},C=function(e){var n=void 0;for(var t in e){var o="$"===t.substr(0,1);if(void 0===n)n=o;else if(n!==o)throw new Error("Inconsistent selector: "+e)}return!!n},b=function(e){if(null==e)return function(e){return y(e,function(e){return null==e})};if(!_.isObject(e))return function(n){return y(n,function(n){return n===e})};if(e instanceof RegExp)return function(n){return void 0===n?!1:y(n,function(n){return e.test(n)})};if(m(e))return function(n){return m(n)?g(n,function(n){return LocalCollection._f._equal(e,n)}):!1};if(C(e)){var n=[];return _.each(e,function(t,o){if(!_.has(L,o))throw new Error("Unrecognized operator: "+o);n.push(L[o](t,e.$options))}),function(e){return _.all(n,function(n){return n(e)})}}return function(n){return y(n,function(n){return LocalCollection._f._equal(e,n)})}},O={$and:function(e){if(!m(e)||_.isEmpty(e))throw Error("$and/$or/$nor must be nonempty array");var n=_.map(e,E);return function(e){return _.all(n,function(n){return n(e)})}},$or:function(e){if(!m(e)||_.isEmpty(e))throw Error("$and/$or/$nor must be nonempty array");var n=_.map(e,E);return function(e){return _.any(n,function(n){return n(e)})}},$nor:function(e){if(!m(e)||_.isEmpty(e))throw Error("$and/$or/$nor must be nonempty array");var n=_.map(e,E);return function(e){return _.all(n,function(n){return!n(e)})}},$where:function(e){return e instanceof Function||(e=Function("return "+e)),function(n){return e.call(n)}}},L={$in:function(e){if(!m(e))throw new Error("Argument to $in must be array");return function(n){return g(n,function(n){return _.any(e,function(e){return LocalCollection._f._equal(e,n)})})}},$all:function(e){if(!m(e))throw new Error("Argument to $all must be array");return function(n){return m(n)?_.all(e,function(e){return _.any(n,function(n){return LocalCollection._f._equal(e,n)})}):!1}},$lt:function(e){return function(n){return y(n,function(n){return LocalCollection._f._cmp(n,e)<0})}},$lte:function(e){return function(n){return y(n,function(n){return LocalCollection._f._cmp(n,e)<=0})}},$gt:function(e){return function(n){return y(n,function(n){return LocalCollection._f._cmp(n,e)>0})}},$gte:function(e){return function(n){return y(n,function(n){return LocalCollection._f._cmp(n,e)>=0})}},$ne:function(e){return function(n){return!g(n,function(n){return LocalCollection._f._equal(n,e)})}},$nin:function(e){if(!m(e))throw new Error("Argument to $nin must be array");var n=L.$in(e);return function(e){return void 0===e?!0:!n(e)}},$exists:function(e){return function(n){return e===(void 0!==n)}},$mod:function(e){var n=e[0],t=e[1];return function(e){return y(e,function(e){return e%n===t})}},$size:function(e){return function(n){return m(n)&&e===n.length}},$type:function(e){return function(n){return void 0===n?!1:y(n,function(n){return LocalCollection._f._type(n)===e})}},$regex:function(e,n){if(void 0!==n){if(/[^gim]/.test(n))throw new Error("Only the i, m, and g regexp options are supported");var t=e instanceof RegExp?e.source:e;e=new RegExp(t,n)}else e instanceof RegExp||(e=new RegExp(e));return function(n){return void 0===n?!1:y(n,function(n){return e.test(n)})}},$options:function(){return function(){return!0}},$elemMatch:function(e){var n=E(e);return function(e){return m(e)?_.any(e,function(e){return n(e)}):!1}},$not:function(e){var n=b(e);return function(e){return!n(e)}}};LocalCollection._f={_type:function(e){return"number"==typeof e?1:"string"==typeof e?2:"boolean"==typeof e?8:m(e)?4:null===e?10:e instanceof RegExp?11:"function"==typeof e?13:e instanceof Date?9:EJSON.isBinary(e)?5:e instanceof Meteor.Collection.ObjectID?7:3},_equal:function(e,n){return EJSON.equals(e,n,{keyOrderSensitive:!0})},_typeorder:function(e){return[-1,1,2,3,4,5,-1,6,7,8,0,9,-1,100,2,100,1,8,1][e]},_cmp:function(e,n){if(void 0===e)return void 0===n?0:-1;if(void 0===n)return 1;var t=LocalCollection._f._type(e),o=LocalCollection._f._type(n),r=LocalCollection._f._typeorder(t),i=LocalCollection._f._typeorder(o);if(r!==i)return i>r?-1:1;if(t!==o)throw Error("Missing type coercion logic in _cmp");
if(7===t&&(t=o=2,e=e.toHexString(),n=n.toHexString()),9===t&&(t=o=1,e=e.getTime(),n=n.getTime()),1===t)return e-n;if(2===o)return n>e?-1:e===n?0:1;if(3===t){var l=function(e){var n=[];for(var t in e)n.push(t),n.push(e[t]);return n};return LocalCollection._f._cmp(l(e),l(n))}if(4===t)for(var c=0;;c++){if(c===e.length)return c===n.length?0:-1;if(c===n.length)return 1;var a=LocalCollection._f._cmp(e[c],n[c]);if(0!==a)return a}if(5===t){if(e.length!==n.length)return e.length-n.length;for(c=0;c<e.length;c++){if(e[c]<n[c])return-1;if(e[c]>n[c])return 1}return 0}if(8===t)return e?n?0:1:n?-1:0;if(10===t)return 0;if(11===t)throw Error("Sorting not supported on regular expression");if(13===t)throw Error("Sorting not supported on Javascript code");throw Error("Unknown type to sort")}},LocalCollection._matches=function(e,n){return LocalCollection._compileSelector(e)(n)},LocalCollection._makeLookupFunction=function(e){var n,t,o,r=e.indexOf(".");if(-1===r)n=e;else{n=e.substr(0,r);var i=e.substr(r+1);t=LocalCollection._makeLookupFunction(i),o=/^\d+(\.|$)/.test(i)}return function(e){if(null==e)return[void 0];var r=e[n];return t?m(r)&&0===r.length?[void 0]:((!m(r)||o)&&(r=[r]),Array.prototype.concat.apply([],_.map(r,t))):[r]}};var E=function(e){var n=[];return _.each(e,function(e,t){if("$"===t.substr(0,1)){if(!_.has(O,t))throw new Error("Unrecognized logical operator: "+t);n.push(O[t](e))}else{var o=LocalCollection._makeLookupFunction(t),r=b(e);n.push(function(e){var n=o(e);return _.any(n,r)})}}),function(e){return _.all(n,function(n){return n(e)})}};LocalCollection._compileSelector=function(e){if(e instanceof Function)return function(n){return e.call(n)};if(LocalCollection._selectorIsId(e))return function(n){return EJSON.equals(n._id,e)};if(!e||"_id"in e&&!e._id)return function(){return!1};if("boolean"==typeof e||m(e)||EJSON.isBinary(e))throw new Error("Invalid selector: "+e);return E(e)},LocalCollection._compileSort=function(e){var n=[];if(e instanceof Array)for(var t=0;t<e.length;t++)"string"==typeof e[t]?n.push({lookup:LocalCollection._makeLookupFunction(e[t]),ascending:!0}):n.push({lookup:LocalCollection._makeLookupFunction(e[t][0]),ascending:"desc"!==e[t][1]});else{if("object"!=typeof e)throw Error("Bad sort specification: ",JSON.stringify(e));for(var o in e)n.push({lookup:LocalCollection._makeLookupFunction(o),ascending:e[o]>=0})}if(0===n.length)return function(){return 0};var r=function(e,n){var t,o=!0;return _.each(e,function(e){m(e)||(e=[e]),m(e)&&0===e.length&&(e=[void 0]),_.each(e,function(e){if(o)t=e,o=!1;else{var r=LocalCollection._f._cmp(t,e);(n&&r>0||!n&&0>r)&&(t=e)}})}),t};return function(e,t){for(var o=0;o<n.length;++o){var i=n[o],l=r(i.lookup(e),i.ascending),c=r(i.lookup(t),i.ascending),a=LocalCollection._f._cmp(l,c);if(0!==a)return i.ascending?a:-a}return 0}},t("lib/selector",function(){}),Meteor={},Meteor._noYieldsAllowed=function(e){return e()},Meteor._SynchronousQueue=function(){var e=this;e._tasks=[],e._running=!1},_.extend(Meteor._SynchronousQueue.prototype,{runTask:function(e){var n=this;if(!n.safeToRunTask())throw new Error("Could not synchronously run a task from a running task");n._tasks.push(e);var t=n._tasks;n._tasks=[],n._running=!0;try{for(;!_.isEmpty(t);){var o=t.shift();try{o()}catch(r){if(_.isEmpty(t))throw r;Meteor._debug("Exception in queued task: "+r.stack)}}}finally{n._running=!1}},queueTask:function(e){var n=this,t=_.isEmpty(n._tasks);n._tasks.push(e),t&&setTimeout(_.bind(n.flush,n),0)},flush:function(){var e=this;e.runTask(function(){})},drain:function(){var e=this;if(e.safeToRunTask())for(;!_.isEmpty(e._tasks);)e.flush()},safeToRunTask:function(){var e=this;return!e._running}}),t("lib/synch-queue",function(){}),LocalCollection._diffQueryChanges=function(e,n,t,o){e?LocalCollection._diffQueryOrderedChanges(n,t,o):LocalCollection._diffQueryUnorderedChanges(n,t,o)},LocalCollection._diffQueryUnorderedChanges=function(e,n,t){if(t.moved)throw new Error("_diffQueryUnordered called with a moved observer!");_.each(n,function(n){if(_.has(e,n._id)){var o=e[n._id];t.changed&&!EJSON.equals(o,n)&&t.changed(n._id,LocalCollection._makeChangedFields(n,o))}else{var r=EJSON.clone(n);delete r._id,t.added&&t.added(n._id,r)}}),t.removed&&_.each(e,function(e){_.has(n,e._id)||t.removed(e._id)})},LocalCollection._diffQueryOrderedChanges=function(e,n,t){var o={};_.each(n,function(e){o[e._id]&&Meteor._debug("Duplicate _id in new_results"),o[e._id]=!0});var r={};_.each(e,function(e,n){e._id in r&&Meteor._debug("Duplicate _id in old_results"),r[e._id]=n});for(var i=[],l=0,c=n.length,a=new Array(c),u=new Array(c),s=function(e){return r[n[e]._id]},f=0;c>f;f++)if(void 0!==r[n[f]._id]){for(var d=l;d>0&&!(s(a[d-1])<s(f));)d--;u[f]=0===d?-1:a[d-1],a[d]=f,d+1>l&&(l=d+1)}for(var h=0===l?-1:a[l-1];h>=0;)i.push(h),h=u[h];i.reverse(),i.push(n.length),_.each(e,function(e){o[e._id]||t.removed&&t.removed(e._id)});var p=0;_.each(i,function(o){for(var i,l,c,a=n[o]?n[o]._id:null,u=p;o>u;u++)l=n[u],_.has(r,l._id)?(i=e[r[l._id]],c=LocalCollection._makeChangedFields(l,i),_.isEmpty(c)||t.changed&&t.changed(l._id,c),t.movedBefore&&t.movedBefore(l._id,a)):(c=EJSON.clone(l),delete c._id,t.addedBefore&&t.addedBefore(l._id,c,a),t.added&&t.added(l._id,c));a&&(l=n[o],i=e[r[l._id]],c=LocalCollection._makeChangedFields(l,i),_.isEmpty(c)||t.changed&&t.changed(l._id,c)),p=o+1})},LocalCollection._diffObjects=function(e,n,t){_.each(e,function(e,o){_.has(n,o)?t.both&&t.both(o,e,n[o]):t.leftOnly&&t.leftOnly(o,e)}),t.rightOnly&&_.each(n,function(n,o){_.has(e,o)||t.rightOnly(o,n)})},t("lib/diff",function(){}),t("backbone-mongo",[],function(){var e=[],n=e.push,t=e.slice,o=e.splice,r=Backbone.Collection.extend({model:Backbone.Model,initialize:function(){},toJSON:function(e){return this.map(function(n){return n.toJSON(e)})},sync:function(){return Backbone.sync.apply(this,arguments)},add:function(e,n){return this.set(e,_.defaults(n||{},{add:!0,merge:!1,remove:!1}))},remove:function(e,n){var t;t=_.isArray(e)?_.any(e,function(e){return e===this._prepareModel(e)},this):e===this._prepareModel(e),e=t?_.isArray(e)?e.slice():[e]:this.find(e).fetch(),n||(n={});var o,r,i,l;for(o=0,r=e.length;r>o;o++)if(l=this.get(e[o])){if(_.isEmpty(e)||!arguments.length)return this._reset(),void 0;delete this._byId[l.id],delete this._byId[l.cid],i=this.indexOf(l),this.models.splice(i,1),this.store.remove({cid:l.cid}),this.length--,n.silent||(n.index=i,l.trigger("remove",l,this,n)),this._removeReference(l)}return this},set:function(e,t){t=_.defaults(t||{}),t.parse&&(e=this.parse(e,t)),_.isArray(e)||(e=e?[e]:[]);var r,i,l,c,a,u=t.at,s=this.comparator&&null==u&&t.sort!==!1,f=_.isString(this.comparator)?this.comparator:null,d=[],h=[],p={};for(r=0,i=e.length;i>r;r++)(l=this._prepareModel(e[r],t))&&((c=this.get(l))?(t.remove&&(p[c.cid]=!0),t.merge&&(c.set(l.attributes,t),s&&!a&&c.hasChanged(f)&&(a=!0))):t.add&&(d.push(l),l.on("all",this._onModelEvent,this),this._byId[l.cid]=l,null!=l.id&&(this._byId[l.id]=l)));if(t.remove){for(r=0,i=this.length;i>r;++r)p[(l=this.models[r]).cid]||h.push(l);h.length&&this.remove(h,t)}if(d.length)if(s&&(a=!0),this.length+=d.length,null!=u){this.store.remove({});var v=_.head(this.models,u).concat(d).concat(_.tail(this.models,u));this._normalizedInsert(v),o.apply(this.models,[u,0].concat(d))}else this._normalizedInsert(d),n.apply(this.models,d);if(a&&this.sort({silent:!0}),t.silent)return this;for(r=0,i=d.length;i>r;r++)(l=d[r]).trigger("add",l,this,t);return a&&this.trigger("sort",this,t),this},reset:function(e,n){n||(n={});for(var t=0,o=this.models.length;o>t;t++)this._removeReference(this.models[t]);return n.previousModels=this.models,this._reset(),this.add(e,_.extend({silent:!0},n)),n.silent||this.trigger("reset",this,n),this},push:function(e,n){return e=this._prepareModel(e,n),this.add(e,_.extend({at:this.length},n)),e},pop:function(e){var n=this.at(this.length-1);return this.remove(n,e),n},unshift:function(e,n){return e=this._prepareModel(e,n),this.add(e,_.extend({at:0},n)),e},shift:function(e){var n=this.at(0);return this.remove(n,e),n},slice:function(e,n){return this.models.slice(e,n)},get:function(e){return null==e?void 0:this._byId[null!=e.id?e.id:e.cid||e]},at:function(e){return this.models[e]},where:function(e,n){if(_.isEmpty(e))return n?void 0:[];var t=function(n){for(var t in e)if(e[t]!==n.get(t))return!1;return!0};return n?_.find(this.models,t):this.filter(t)},findWhere:function(e){return this.where(e,!0)},sort:function(e){if(!this.comparator)throw new Error("Cannot sort a set without a comparator");return e||(e={}),_.isString(this.comparator)||1===this.comparator.length?this.models=this.sortBy(this.comparator,this):this.models.sort(_.bind(this.comparator,this)),this.store.remove({}),this._normalizedInsert(this.models),e.silent||this.trigger("sort",this,e),this},sortedIndex:function(e,n,t){n||(n=this.comparator);var o=_.isFunction(n)?n:function(e){return e.get(n)};return _.sortedIndex(this.models,e,o,t)},pluck:function(e){return _.invoke(this.models,"get",e)},fetch:function(e){e=e?_.clone(e):{},void 0===e.parse&&(e.parse=!0);var n=e.success,t=this;return e.success=function(o){var r=e.reset?"reset":"set";t[r](o,e),n&&n(t,o,e),t.trigger("sync",t,o,e)},this.sync("read",this,e)},create:function(e,n){if(n=n?_.clone(n):{},!(e=this._prepareModel(e,n)))return!1;n.wait||this.add(e,n);var t=this,o=n.success;return n.success=function(r){n.wait&&t.add(e,n),o&&o(e,r,n)},e.save(null,n),e},parse:function(e){return e},clone:function(){return new this.constructor(this.models)},_reset:function(){this.length=0,this.models=[],this.store=new LocalCollection,this._byId={}},_prepareModel:function(e,n){if(e instanceof Backbone.Model)return e.collection||(e.collection=this),e;n||(n={}),n.collection=this;var t=new this.model(e,n);return t._validate(e,n)?t:(this.trigger("invalid",this,e,n),!1)},_removeReference:function(e){this===e.collection&&delete e.collection,e.off("all",this._onModelEvent,this)},_onModelEvent:function(e,n,t,o){if("add"!==e&&"remove"!==e||t===this){if("destroy"===e&&this.remove(n,o),o&&!o.fromUpdate&&n&&/change\:/.test(e)){var r=/change\:(.*)/.exec(e)[1],i=t,l={};l[r]=i,this.update({cid:n.cid},{$set:l},this._byId)}n&&e==="change:"+n.idAttribute&&(delete this._byId[n.previous(n.idAttribute)],null!=n.id&&(this._byId[n.id]=n)),this.trigger.apply(this,arguments)}},insert:function(e,n){return this.add(e,n)},find:function(e,n){return _.isFunction(e)?_.find(this.models,e,n):this.store.find(e||{},n,this._byId)},findOne:function(e,n){return this.store.findOne(e||{},n,this._byId)},update:function(e,n,t){t=t?t:{multi:!1},this.store.update(e,n,t,this._byId)},_normalizedInsert:function(e){_.each(e,function(e){this.store.insert(_.extend(e.toJSON(),{cid:e.cid}))},this)}}),i=["forEach","each","map","collect","reduce","foldl","inject","reduceRight","foldr","find","detect","filter","select","reject","every","all","some","any","include","contains","invoke","max","min","toArray","size","first","head","take","initial","rest","tail","drop","last","without","indexOf","shuffle","lastIndexOf","isEmpty","chain"];_.each(i,function(e){Backbone.Collection.prototype[e]=function(){var n=t.call(arguments);return n.unshift(this.models),_[e].apply(_,n)}});var l=["groupBy","countBy","sortBy"];return _.each(l,function(e){Backbone.Collection.prototype[e]=function(n,t){var o=_.isFunction(n)?n:function(e){return e.get(n)};return _[e](this.models,o,t)}}),r}),window.Backbone.Mongo=n("backbone-mongo")});